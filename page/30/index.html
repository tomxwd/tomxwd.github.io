<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/ico/girl-128x128.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/ico/girl-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/ico/girl-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="tomxwd.blog" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="tomxwd">
<meta name="keywords" content="blog">
<meta property="og:type" content="website">
<meta property="og:title" content="tomxwd.blog">
<meta property="og:url" content="http:&#x2F;&#x2F;www.blog.tomxwd.com&#x2F;page&#x2F;30&#x2F;index.html">
<meta property="og:site_name" content="tomxwd.blog">
<meta property="og:description" content="tomxwd">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.blog.tomxwd.com/page/30/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>tomxwd.blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">tomxwd.blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/tomxwd" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/08/Redis/07_Redis_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/08/Redis/07_Redis_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="post-title-link" itemprop="url">07_Redis的主从复制</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-08 15:27:33" itemprop="dateCreated datePublished" datetime="2019-08-08T15:27:33+08:00">2019-08-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 12:19:02" itemprop="dateModified" datetime="2020-02-16T12:19:02+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="07-Redis的主从复制（Master-Slave"><a href="#07-Redis的主从复制（Master-Slave" class="headerlink" title="07_Redis的主从复制（Master/Slave)"></a>07_Redis的主从复制（Master/Slave)</h1><h2 id="Redis的主从复制是什么"><a href="#Redis的主从复制是什么" class="headerlink" title="Redis的主从复制是什么"></a>Redis的主从复制是什么</h2><blockquote>
<p> <a href="https://redis.io/topics/replication" target="_blank" rel="noopener">官网文档</a></p>
<p> <a href="http://redisdoc.com/index.html" target="_blank" rel="noopener">文档2</a></p>
</blockquote>
<p>也就是我们所说的主从复制，主机数据更新后根据配置和策略，自动同步到备机的master/slave机制，Master以写为主，Slave以读为主。</p>
<h2 id="Redis的主从复制能干嘛"><a href="#Redis的主从复制能干嘛" class="headerlink" title="Redis的主从复制能干嘛"></a>Redis的主从复制能干嘛</h2><ul>
<li>读写分离</li>
<li>容灾恢复</li>
</ul>
<h2 id="Redis的主从复制怎么用"><a href="#Redis的主从复制怎么用" class="headerlink" title="Redis的主从复制怎么用"></a>Redis的主从复制怎么用</h2><ol>
<li><p>配从（从库）不配主（主库）</p>
</li>
<li><p>从库配置：slaveof 主库ip 主库端口</p>
<ul>
<li>每次和master断开之后，都需要重新连接，除非你配置进redis.conf文件</li>
<li>info replication</li>
</ul>
</li>
<li><p>修改配置文件细节操作</p>
<ul>
<li>拷贝多个redis.conf文件</li>
<li>开启daemonize yes</li>
<li>关闭protected-mode</li>
<li>bind也去掉</li>
<li>Pid文件名字</li>
<li>指定端口</li>
<li>log文件名字</li>
<li>dump.rdb名字</li>
</ul>
</li>
<li><p>常用3招</p>
<p>可以用<code>info replication</code>查看复制信息。</p>
<ul>
<li><p>一主二仆</p>
<ul>
<li><p>init</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/07_redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-1.png" alt="07_redis主从复制-1"></p>
</li>
<li><p>一个Master两个Slave</p>
</li>
<li><p>日志查看</p>
</li>
<li><p>主从问题演示</p>
<ul>
<li>主挂了，从原地待命</li>
<li>从挂了，重新连接，建立从关系，继续使用</li>
</ul>
</li>
</ul>
</li>
<li><p>薪火相传</p>
<ul>
<li>上一个slave可以是下一个slave的master，slave同样可以接收其他salves的连接和同步请求，那么该slave作为了链条中下一个master，可以有效减轻master的写压力</li>
<li>中途变更转向：会清除之前的数据，重新建立拷贝最新的</li>
<li>slaveof 新主库IP 新主库端口</li>
</ul>
</li>
<li><p>反客为主</p>
<ul>
<li>slaveof no one，脱离slave，然后让其他还存活的slaveof这部master</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Redis复制的原理"><a href="#Redis复制的原理" class="headerlink" title="Redis复制的原理"></a>Redis复制的原理</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/07_redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-2.png" alt="07_redis主从复制-2"></p>
<ul>
<li><p>slave启动成功连接到master后发送一个sync命令。</p>
</li>
<li><p>master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，master将传送整个数据文件到slave，以完成一次完全同步。</p>
</li>
<li><p>全量复制：slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p>
</li>
<li><p>增量复制：master继续将新的所有收集到的修改命令依次传给slave，完成同步。</p>
</li>
<li><p>但是只要是重新连接master，一次完全同步（全量复制）将被自动执行。</p>
</li>
</ul>
<h2 id="Redis的哨兵模式"><a href="#Redis的哨兵模式" class="headerlink" title="Redis的哨兵模式"></a>Redis的哨兵模式</h2><ul>
<li><p>哨兵模式是什么</p>
<p>反客为主的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将库转为主库</p>
</li>
<li><p>使用步骤：</p>
<ol>
<li>调整结构，6379带80、81</li>
<li>在解压的redis目录下有sentinel.conf文件，复制出来修改即可，要把protected mode、port、log、pidfile、bind、daemonize 修改。（daemonize可以no，方便查看日志输出）</li>
<li>配置哨兵，填写内容<ul>
<li>sentinel monitor 被监控数据库名字（自己起的名字）127.0.0.1 6379 1</li>
<li><strong>上面最后一个数字1，表示主机挂掉后sentinel投票看让谁接替成为主机，得票数多少后成为主机</strong></li>
</ul>
</li>
<li>启动哨兵<ul>
<li>redis-sentinel /mybatis/sentinel.conf，目录可以依照各自的实际情况进行配置。</li>
</ul>
</li>
<li>正常主从演示</li>
<li>原有master挂了<ul>
<li>直接用客户端shutdown服务。</li>
</ul>
</li>
<li>投票新选</li>
<li>重新主从继续开工，info replication查看信息</li>
<li>问题：如果之前的master重启，会不会双master冲突？</li>
</ol>
</li>
<li><p>一组sentinel能同时监控多个master</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br><span class="line">port 12385</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile "/var/run/redis-sentinel.pid"</span><br><span class="line">logfile "12385.log"</span><br><span class="line">dir "/myredis"</span><br><span class="line">sentinel myid 92c44e25dfdd05250f25b2d44bbf2a11cf230e4f</span><br><span class="line">sentinel deny-scripts-reconfig yes</span><br><span class="line">sentinel monitor mymaster 120.79.145.202 12386 1</span><br><span class="line">sentinel config-epoch mymaster 3</span><br><span class="line">sentinel leader-epoch mymaster 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by CONFIG REWRITE</span></span><br><span class="line">sentinel known-replica mymaster 120.79.145.202 12388</span><br><span class="line">sentinel known-replica mymaster 120.79.145.202 12387</span><br><span class="line">sentinel current-epoch 3</span><br></pre></td></tr></table></figure>

<p>可以看详细的英文注释，这里不做多解释，注意有的默认时长是30秒、3分钟、5分钟的，没生效的话看sentinel的日志，看看是不是还没到时间。</p>
<h2 id="Redis复制的缺点"><a href="#Redis复制的缺点" class="headerlink" title="Redis复制的缺点"></a>Redis复制的缺点</h2><h3 id="复制的延时"><a href="#复制的延时" class="headerlink" title="复制的延时"></a>复制的延时</h3><p>由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。</p>
<h2 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h2><h3 id="Jedis所需要的jar包"><a href="#Jedis所需要的jar包" class="headerlink" title="Jedis所需要的jar包"></a>Jedis所需要的jar包</h3><ul>
<li>Commons-pool-1.6.jar</li>
<li>Jedis-2.1.0.jar</li>
</ul>
<h3 id="Jedis常用操作"><a href="#Jedis常用操作" class="headerlink" title="Jedis常用操作"></a>Jedis常用操作</h3><h4 id="测试联通性"><a href="#测试联通性" class="headerlink" title="测试联通性"></a>测试联通性</h4><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"XxxHost"</span>,<span class="number">6379</span>);</span><br><span class="line">    System.out.println(<span class="string">"jedis.ping() = "</span> + jedis.ping());</span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jedis.ping() = PONG</span><br></pre></td></tr></table></figure>



<h4 id="5-1"><a href="#5-1" class="headerlink" title="5+1"></a>5+1</h4><ul>
<li>一个key</li>
<li>五大数据类型</li>
</ul>
<h4 id="事务提交"><a href="#事务提交" class="headerlink" title="事务提交"></a>事务提交</h4><ul>
<li><p>日常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTxTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jedis = <span class="keyword">new</span> Jedis(<span class="string">"tomxwd.top"</span>,<span class="number">12388</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Transaction transaction = jedis.multi();</span><br><span class="line">        transaction.set(<span class="string">"k4"</span>,<span class="string">"v4"</span>);</span><br><span class="line">        transaction.set(<span class="string">"k5"</span>,<span class="string">"v5"</span>);</span><br><span class="line">        <span class="comment">//transaction.exec();</span></span><br><span class="line">        transaction.discard();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>加锁</p>
<p>通俗点讲，watch命令就是标记一个键，如果标记了一个键，在提交事务前如果该键被别人修改过，那事务就会失败，这种情况通常可以在程序中重新再尝试一次。</p>
<p>首先标记了键balance，然后检查余额是否足够，不足就取消标记，并不做扣减；</p>
<p>足够的话，就启动事务进行更新操作；</p>
<p>如果在此期间键balance被其他人修改，那在提交事务（执行exec）时就会报错，</p>
<p>程序中通常可以捕获这类错误再重新执行一次，直到成功。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTxTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jedis = <span class="keyword">new</span> Jedis(<span class="string">"tomxwd.top"</span>,<span class="number">12388</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">transMethod</span><span class="params">(Jedis jedis)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> balance;<span class="comment">//可用余额</span></span><br><span class="line">        <span class="keyword">int</span> debt;<span class="comment">//欠额</span></span><br><span class="line">        <span class="keyword">int</span> amtToSubtract = <span class="number">10</span>;<span class="comment">//实刷额度</span></span><br><span class="line">        jedis.watch(<span class="string">"balance"</span>);</span><br><span class="line">        <span class="comment">// 下面这句是为了模拟其他程序修改了这个balance</span></span><br><span class="line">        jedis.set(<span class="string">"balance"</span>,<span class="string">"5"</span>);</span><br><span class="line">        balance = Integer.parseInt(jedis.get(<span class="string">"balance"</span>));</span><br><span class="line">        <span class="keyword">if</span>(balance &lt; amtToSubtract)&#123;</span><br><span class="line">            jedis.unwatch();</span><br><span class="line">            System.out.println(<span class="string">"已被修改"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"-------transaction--------"</span>);</span><br><span class="line">            Transaction tx = jedis.multi();</span><br><span class="line">            tx.decrBy(<span class="string">"balance"</span>,amtToSubtract);</span><br><span class="line">            tx.incrBy(<span class="string">"debt"</span>,amtToSubtract);</span><br><span class="line">            tx.exec();</span><br><span class="line">            balance = Integer.parseInt(jedis.get(<span class="string">"balance"</span>));</span><br><span class="line">            debt = Integer.parseInt(jedis.get(<span class="string">"debt"</span>));</span><br><span class="line">            System.out.println(<span class="string">"balance = "</span> + balance);</span><br><span class="line">            System.out.println(<span class="string">"debt = "</span> + debt);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JedisTxTest test = <span class="keyword">new</span> JedisTxTest();</span><br><span class="line">        <span class="keyword">boolean</span> retValue = test.transMethod(<span class="keyword">this</span>.jedis);</span><br><span class="line">        System.out.println(<span class="string">"retValue = "</span> + retValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h4><p>6379和6380先启动，各自独立。</p>
<p>主写，从读；</p>
<h3 id="JedisPool"><a href="#JedisPool" class="headerlink" title="JedisPool"></a>JedisPool</h3><ul>
<li><p>获取Jedis实例需要从JedisPool中获取</p>
</li>
<li><p>用完Jedis实例需要返还给JedisPool</p>
</li>
<li><p>如果Jedis在使用过程中出错，也需要还给JedisPool</p>
</li>
<li><p>案例见代码：</p>
<ul>
<li><p>JedisPoolUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JedisPoolUtil</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title">getJedisPoolInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==jedisPool)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (JedisPoolUtil<span class="class">.<span class="keyword">class</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">null</span>==jedisPool)&#123;</span><br><span class="line">                    JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">                    poolConfig.setMaxIdle(<span class="number">32</span>);</span><br><span class="line">                    poolConfig.setMaxTotal(<span class="number">1000</span>);</span><br><span class="line">                    poolConfig.setMaxWaitMillis(<span class="number">100</span>*<span class="number">1000</span>);</span><br><span class="line">                    poolConfig.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">                    jedisPool = <span class="keyword">new</span> JedisPool(poolConfig,<span class="string">"tomxwd.top"</span>,<span class="number">12388</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(Jedis jedis)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=jedis)&#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Demo5</p>
<p><strong>JedisPool.getResource();</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PoolTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JedisPool jedisPool = JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">        Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = jedisPool.getResource();</span><br><span class="line">            jedis.set(<span class="string">"aaa"</span>,<span class="string">"bbb"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JedisPoolUtil.release(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>配置总结all</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/07_redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-3.png" alt="07_redis主从复制-3"></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/08/Redis/06_Redis_%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/08/Redis/06_Redis_%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" class="post-title-link" itemprop="url">06_Redis_发布订阅</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-08 15:13:17" itemprop="dateCreated datePublished" datetime="2019-08-08T15:13:17+08:00">2019-08-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 12:17:19" itemprop="dateModified" datetime="2020-02-16T12:17:19+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="06-Redis-发布订阅"><a href="#06-Redis-发布订阅" class="headerlink" title="06_Redis_发布订阅"></a>06_Redis_发布订阅</h1><h2 id="Redis的发布订阅是什么"><a href="#Redis的发布订阅是什么" class="headerlink" title="Redis的发布订阅是什么"></a>Redis的发布订阅是什么</h2><ul>
<li><p>进程间的一种消息通信模式：发送者（pub）发送消息，订阅者（sub）接收消息。</p>
</li>
<li><p>订阅/发布消息图</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/06_redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85-1.png" alt="06_redis发布订阅-1"></p>
</li>
</ul>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/pub-sub-psubscribe.html" target="_blank" rel="noopener">PSUBSCRIBE pattern [pattern …]</a>  订阅一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">[PUBSUB subcommand [argument [argument …]]](<a href="https://www.runoob.com/redis/pub-sub-pubsub.html" target="_blank" rel="noopener">https://www.runoob.com/redis/pub-sub-pubsub.html</a>)  查看订阅与发布系统状态。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/pub-sub-publish.html" target="_blank" rel="noopener">PUBLISH channel message</a>  将信息发送到指定的频道。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">[PUNSUBSCRIBE [pattern [pattern …]]](<a href="https://www.runoob.com/redis/pub-sub-punsubscribe.html" target="_blank" rel="noopener">https://www.runoob.com/redis/pub-sub-punsubscribe.html</a>)  退订所有给定模式的频道。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/pub-sub-subscribe.html" target="_blank" rel="noopener">SUBSCRIBE channel [channel …]</a>  订阅给定的一个或多个频道的信息。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">[UNSUBSCRIBE [channel [channel …]]](<a href="https://www.runoob.com/redis/pub-sub-unsubscribe.html" target="_blank" rel="noopener">https://www.runoob.com/redis/pub-sub-unsubscribe.html</a>)  指退订给定的频道。</td>
</tr>
</tbody></table>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/06_redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85-2.png" alt="06_redis发布订阅-2"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/08/Redis/05_Redis_%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/08/Redis/05_Redis_%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">05_Reids_事务</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-08 11:16:29" itemprop="dateCreated datePublished" datetime="2019-08-08T11:16:29+08:00">2019-08-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 12:14:45" itemprop="dateModified" datetime="2020-02-16T12:14:45+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="05-Reids-事务"><a href="#05-Reids-事务" class="headerlink" title="05_Reids_事务"></a>05_Reids_事务</h1><h2 id="Redis事务是什么"><a href="#Redis事务是什么" class="headerlink" title="Redis事务是什么"></a>Redis事务是什么</h2><ul>
<li><p>可以一次执行多个命令，本质是一组命令的集合。一个事务中的所有命令都会序列化，<strong>按顺序地串行化执行，而不会被其他命令插入，不许加塞</strong></p>
</li>
<li><p>官网</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-1.png" alt="05_redis事务-1"></p>
</li>
</ul>
<h2 id="Redis事务能干嘛"><a href="#Redis事务能干嘛" class="headerlink" title="Redis事务能干嘛"></a>Redis事务能干嘛</h2><p>一个队列中，一次性、顺序性、排他性的执行一系列命令。</p>
<h2 id="怎么用Redis事务"><a href="#怎么用Redis事务" class="headerlink" title="怎么用Redis事务"></a>怎么用Redis事务</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-2.png" alt="05_redis事务-2"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-3.png" alt="05_redis事务-3"></p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/transactions-discard.html" target="_blank" rel="noopener">DISCARD</a>  取消事务，放弃执行事务块内的所有命令。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/transactions-exec.html" target="_blank" rel="noopener">EXEC</a>  执行所有事务块内的命令。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/transactions-multi.html" target="_blank" rel="noopener">MULTI</a>  标记一个事务块的开始。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/transactions-unwatch.html" target="_blank" rel="noopener">UNWATCH</a>  取消 WATCH 命令对所有 key 的监视。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/transactions-watch.html" target="_blank" rel="noopener">WATCH key [key …]</a>  监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</td>
</tr>
</tbody></table>
<h3 id="正常执行"><a href="#正常执行" class="headerlink" title="正常执行"></a>正常执行</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-4.png" alt="05_redis事务-4"></p>
<h3 id="放弃事务"><a href="#放弃事务" class="headerlink" title="放弃事务"></a>放弃事务</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-5.png" alt="05_redis事务-5"></p>
<h3 id="全体连坐"><a href="#全体连坐" class="headerlink" title="全体连坐"></a>全体连坐</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-6.png" alt="05_redis事务-6"></p>
<h3 id="冤头债主"><a href="#冤头债主" class="headerlink" title="冤头债主"></a>冤头债主</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-7.png" alt="05_redis事务-7"></p>
<h3 id="watch监控"><a href="#watch监控" class="headerlink" title="watch监控"></a>watch监控</h3><h4 id="悲观锁-乐观锁-CAS-Check-And-Set"><a href="#悲观锁-乐观锁-CAS-Check-And-Set" class="headerlink" title="悲观锁/乐观锁/CAS(Check And Set)"></a>悲观锁/乐观锁/CAS(Check And Set)</h4><ul>
<li><p>悲观锁</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-8.png" alt="05_redis事务-8"></p>
</li>
<li><p>乐观锁</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-9.png" alt="05_redis事务-9"></p>
</li>
<li><p>CAS</p>
</li>
</ul>
<ol>
<li><p>初始化信用卡可用余额和欠额</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set balance 100</span><br><span class="line">set debt 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>无加塞篡改，先监控再开启multi，保证两笔金额变动在同一个事务内。</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-10.png" alt="05_redis事务-10"></p>
</li>
<li><p>有加塞篡改</p>
<p>一处watch balance，另一处进行set balance 800操作，然后第一处又执行MULTI，开始事务，最后失败。</p>
<p>监控了key，如果key被修改了，后面一个事务的执行失效。</p>
<p>watch：监视一个或多个key，如果事务执行之前，这些key被改动，事务将被打断。</p>
</li>
<li><p>unwatch</p>
<p>取消watch命令对所有key的监视。</p>
</li>
<li><p><strong>一旦执行了exec，之前加的监控锁都会被取消掉</strong></p>
</li>
<li><p>小结</p>
<ul>
<li>watch命令，类似乐观锁，事务提交的时候，如果key的值已经<strong>被别的客户端改变</strong>，比如某个list已经被别的客户端push/pop过了，整个事务队列都不会被执行。</li>
<li>通过watch命令在事务执行之前监控了多个key，倘若在watch之后有任何key的值发生了变化，exec命令执行的事务都将被放弃，同时返回Nullmulti-bulk应答以通知调用者事务执行失败。</li>
</ul>
</li>
</ol>
<h2 id="3阶段"><a href="#3阶段" class="headerlink" title="3阶段"></a>3阶段</h2><ul>
<li>开启：以MULTI开始一个事务。</li>
<li>入队：将多个命令入队到事务中，接到这些命令并不会立即执行，而是放到等待执行的事务队列里面。</li>
<li>执行：由EXEC命令触发事务。</li>
</ul>
<h2 id="3特性"><a href="#3特性" class="headerlink" title="3特性"></a>3特性</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/05_redis%E4%BA%8B%E5%8A%A1-11.png" alt="05_redis事务-11"></p>
<ul>
<li>单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发来的命令请求所打断。</li>
<li>没有隔离级别的概念：队列中的命令没有提交之前都不会实际的被执行，因为事务提交前任何指令都不会被实际执行。也就不存在“事务内的查询要看到事务里的更新，在事务处查询不能看到”，这个让人万分头痛的问题。</li>
<li>不保证原子性：redis同一个事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/07/MyBatis/03_MyBatis_HelloWorld/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/07/MyBatis/03_MyBatis_HelloWorld/" class="post-title-link" itemprop="url">03_Mybatis_HelloWorld</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-07 22:36:58" itemprop="dateCreated datePublished" datetime="2019-08-07T22:36:58+08:00">2019-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-16 17:59:16" itemprop="dateModified" datetime="2019-11-16T17:59:16+08:00">2019-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mybatis/" itemprop="url" rel="index">
                    <span itemprop="name">Mybatis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="03-Mybatis-HelloWorld"><a href="#03-Mybatis-HelloWorld" class="headerlink" title="03_Mybatis_HelloWorld"></a>03_Mybatis_HelloWorld</h1><blockquote>
<p><a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">参考文档</a></p>
</blockquote>
<h2 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果mapper.xml放在src/java目录下，编译不到target包的话加这段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl_employee(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">11</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">  last_name <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	email <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="创建对应的javaBean类"><a href="#创建对应的javaBean类" class="headerlink" title="创建对应的javaBean类"></a>创建对应的javaBean类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://tomxwd.top:12389/mybatis"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将我们写好的sql映射文件注册到全局配置文件中来--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"EmployeeMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>改官网给的。</p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global logging configuration</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">trace, stdout</span></span><br><span class="line"><span class="comment"># MyBatis logging configuration...</span></span><br><span class="line"><span class="meta">log4j.logger</span>=<span class="string">TRACE</span></span><br><span class="line"><span class="comment"># Console output...</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br></pre></td></tr></table></figure>

<p>改官网给的。</p>
<h2 id="Mapper文件"><a href="#Mapper文件" class="headerlink" title="Mapper文件"></a>Mapper文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    namespace:命名空间</span></span><br><span class="line"><span class="comment">    id：唯一标识符</span></span><br><span class="line"><span class="comment">    resultType：返回值类型</span></span><br><span class="line"><span class="comment">    #&#123;id&#125;:从传递过来的参数中取出id值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"top.tomxwd.mybatis.mapper.EmployeeMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectEmp"</span> <span class="attr">resultType</span>=<span class="string">"top.tomxwd.mybatis.bean.Employee"</span>&gt;</span></span><br><span class="line">        SELECT id,last_name lastName,email,gender FROM tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>改官网给的。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tomxwd.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> top.tomxwd.mybatis.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. 根据xml配置文件（全局配置文件）创建一个SQLSessionFactory对象</span></span><br><span class="line"><span class="comment">     *    有数据源一些运行环境的信息</span></span><br><span class="line"><span class="comment">     * 2. sql映射文件，配置了每个SQL，以及SQL的封装规则等</span></span><br><span class="line"><span class="comment">     * 3. 将sql映射文件注册在全局配置文件中去。</span></span><br><span class="line"><span class="comment">     * 4. 写代码</span></span><br><span class="line"><span class="comment">     *      1）根据全局配置文件得到sqlSessionFactory</span></span><br><span class="line"><span class="comment">     *      2）使用sqlSession工厂，获得sqlSession对象，使用这个对象执行增删改查</span></span><br><span class="line"><span class="comment">     *          一个sqlSession就是代表和数据库的一次会话，用完需要关闭</span></span><br><span class="line"><span class="comment">     *      3）使用sql的唯一标识来告诉mybatis执行哪个sql，sql都是保存在sql映射文件中的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">        InputStream stream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(stream);</span><br><span class="line">        <span class="comment">// 2. 获取sqlSession实例，能直接执行已经映射的sql语句</span></span><br><span class="line">        <span class="comment">// 两个参数</span></span><br><span class="line">        <span class="comment">// sql的唯一标识符</span></span><br><span class="line">        <span class="comment">// 执行sql要用的参数</span></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        Employee employee = (Employee) sqlSession.selectOne(<span class="string">"top.tomxwd.mybatis.mapper.EmployeeMapper.selectEmp"</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">"employee = "</span> + employee);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/07/MyBatis/02_MyBatis_%E4%B8%8B%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/07/MyBatis/02_MyBatis_%E4%B8%8B%E8%BD%BD/" class="post-title-link" itemprop="url">02_Mybatis_下载</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-07 22:24:22" itemprop="dateCreated datePublished" datetime="2019-08-07T22:24:22+08:00">2019-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-16 17:59:16" itemprop="dateModified" datetime="2019-11-16T17:59:16+08:00">2019-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mybatis/" itemprop="url" rel="index">
                    <span itemprop="name">Mybatis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="02-Mybatis-下载"><a href="#02-Mybatis-下载" class="headerlink" title="02_Mybatis_下载"></a>02_Mybatis_下载</h1><p><a href="https://github.com/mybatis/mybatis-3" target="_blank" rel="noopener">下载地址</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/07/Redis/04_Redis_%E6%8C%81%E4%B9%85%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/07/Redis/04_Redis_%E6%8C%81%E4%B9%85%E5%8C%96/" class="post-title-link" itemprop="url">04_Redis_持久化</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-07 17:21:17" itemprop="dateCreated datePublished" datetime="2019-08-07T17:21:17+08:00">2019-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 12:09:26" itemprop="dateModified" datetime="2020-02-16T12:09:26+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="04-Redis-持久化"><a href="#04-Redis-持久化" class="headerlink" title="04_Redis_持久化"></a>04_Redis_持久化</h1><h2 id="总体介绍"><a href="#总体介绍" class="headerlink" title="总体介绍"></a>总体介绍</h2><p><a href="https://redis.io/topics/persistence" target="_blank" rel="noopener">redis官网介绍持久化</a></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-1.png" alt="04_redis持久化-1"></p>
<h2 id="RDB（Redis-DataBase）"><a href="#RDB（Redis-DataBase）" class="headerlink" title="RDB（Redis DataBase）"></a>RDB（Redis DataBase）</h2><h3 id="官网介绍"><a href="#官网介绍" class="headerlink" title="官网介绍"></a>官网介绍</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-2.png" alt="04_redis持久化-2"></p>
<h3 id="RDB是什么"><a href="#RDB是什么" class="headerlink" title="RDB是什么"></a>RDB是什么</h3><ul>
<li><p>在<strong>指定的时间间隔内</strong>将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里。</p>
</li>
<li><p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。</p>
</li>
<li><p>整个过程中，主进程是不会进行任何IO操作的，这就确保了极高的性能。</p>
</li>
<li><p>如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。</p>
</li>
<li><p>RDB的缺点是最后一次持久化后的数据可能丢失。</p>
</li>
</ul>
<h3 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h3><p>Fork的作用是复制一个与当前进程一样的进程。</p>
<p>新进程的所有数据（变量、环境变量、程序计数器等）数值都与原进程一致，但是是一个全新的进程，并作为原进程的子进程。</p>
<h3 id="RDB保存的是dump-rdb文件"><a href="#RDB保存的是dump-rdb文件" class="headerlink" title="RDB保存的是dump.rdb文件"></a>RDB保存的是dump.rdb文件</h3><h3 id="配置文件位置"><a href="#配置文件位置" class="headerlink" title="配置文件位置"></a>配置文件位置</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-3.png" alt="04_redis持久化-3"></p>
<ul>
<li>900秒（15分钟）有1个key改变就触发；</li>
<li>300秒（5分钟）有10个key改变就触发；</li>
<li>60秒（1分钟）有10000个key改变就触发；</li>
<li>改为save””就不触发；</li>
<li>FLUSHDB、FLUSHALL、SHUTDOWN操作，都会更新一次新的内容。</li>
<li>可以手动save，输入save指令即可</li>
</ul>
<h3 id="如何触发RDB快照"><a href="#如何触发RDB快照" class="headerlink" title="如何触发RDB快照"></a>如何触发RDB快照</h3><h4 id="配置文件中默认的快照配置"><a href="#配置文件中默认的快照配置" class="headerlink" title="配置文件中默认的快照配置"></a>配置文件中默认的快照配置</h4><p>冷拷贝后重新使用，可以用cp dump.rdb dump_new.rdb</p>
<h4 id="命令save或bgsave"><a href="#命令save或bgsave" class="headerlink" title="命令save或bgsave"></a>命令save或bgsave</h4><ul>
<li>save：save时只管保存，其他不管，全部阻塞</li>
<li>bgsave：Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求，可以通过lastsave命令来获取最后一次成功执行快照的时间。</li>
</ul>
<h4 id="执行FLUSHALL命令，也会产生dump-rdb文件，但里面是空的，无意义"><a href="#执行FLUSHALL命令，也会产生dump-rdb文件，但里面是空的，无意义" class="headerlink" title="执行FLUSHALL命令，也会产生dump.rdb文件，但里面是空的，无意义"></a>执行FLUSHALL命令，也会产生dump.rdb文件，但里面是空的，无意义</h4><h3 id="如何恢复"><a href="#如何恢复" class="headerlink" title="如何恢复"></a>如何恢复</h3><p>将备份文件(dump.rdb)移动到redis启动目录并启动服务即可。</p>
<p>config get dir 获取目录</p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>适合大规模的数据恢复</li>
<li>对数据完整性和一致性要求不高</li>
</ul>
<h3 id="劣势"><a href="#劣势" class="headerlink" title="劣势"></a>劣势</h3><ul>
<li>在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改。</li>
<li>Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑。</li>
</ul>
<h3 id="如何停止"><a href="#如何停止" class="headerlink" title="如何停止"></a>如何停止</h3><p>动态停止所有RDB保存规则的方法：redis-cli config set save “”</p>
<h3 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-4.png" alt="04_redis持久化-4"></p>
<h2 id="AOF（Append-Only-Flie）"><a href="#AOF（Append-Only-Flie）" class="headerlink" title="AOF（Append Only Flie）"></a>AOF（Append Only Flie）</h2><h3 id="官网介绍-1"><a href="#官网介绍-1" class="headerlink" title="官网介绍"></a>官网介绍</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-5.png" alt="04_redis持久化-5"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-6.png" alt="04_redis持久化-6"></p>
<h3 id="AOF是什么"><a href="#AOF是什么" class="headerlink" title="AOF是什么"></a>AOF是什么</h3><p><strong>以日志的形式来记录每个写操作</strong>，将Redis执行过的所有写指令记录下来（读操作不记录），只许追加文件单不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
<h3 id="AOF保存的是appendonly-aof文件"><a href="#AOF保存的是appendonly-aof文件" class="headerlink" title="AOF保存的是appendonly.aof文件"></a>AOF保存的是appendonly.aof文件</h3><h3 id="配置位置"><a href="#配置位置" class="headerlink" title="配置位置"></a>配置位置</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-7.png" alt="04_redis持久化-7"></p>
<p>appendonly yes </p>
<h3 id="AOF启动-修复-恢复"><a href="#AOF启动-修复-恢复" class="headerlink" title="AOF启动/修复/恢复"></a>AOF启动/修复/恢复</h3><ul>
<li><p>正常恢复</p>
<ul>
<li><p>启动：修改默认的appendonly no，改为yes</p>
</li>
<li><p>将有数据的aof文件复制一份保存到对应目录（config get dir）</p>
</li>
<li><p>恢复：重启redis然后重新加载</p>
</li>
</ul>
</li>
<li><p>异常恢复</p>
<ul>
<li>启动：appendonly yes</li>
<li>备份被写坏的AOF文件</li>
<li>修复：<code>redis-check-aof --fix</code>进行修复（也有<code>redis-check-dump</code>）</li>
<li>恢复：重启redis然后重新加载</li>
</ul>
</li>
</ul>
<h3 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-8.png" alt="04_redis持久化-8"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-9.png" alt="04_redis持久化-9"></p>
<ul>
<li>rewrite是什么<ul>
<li>AOF采用文件追加方式，文件会越来越大，为了避免出现此种情况，新增了重写机制，当AOF文件的大小超过所设定的阈值时，redis就会启动AOF文件的内容压缩，只保留可以恢复数据的最小指令集，可以使用命令<code>bgrewriteaof</code>来手动重写。</li>
</ul>
</li>
<li>重写原理<ul>
<li>AOF文件持续增长而过大时，会fork出一条新进程来将文件重写（也是先写临时文件最后再rename），遍历新进程的内存中的数据，每条记录有一条的set语句。重写aof文件的操作，并没有读取旧的aof文件，而是将整个内存中的数据库内容用命令的方式重写了一个新的aof文件，这点和快照有点类似。</li>
</ul>
</li>
<li>触发机制<ul>
<li><strong>redis会记录上次重写时的aof大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍，且文件大于64M时触发。</strong></li>
</ul>
</li>
</ul>
<h3 id="优势-1"><a href="#优势-1" class="headerlink" title="优势"></a>优势</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-10.png" alt="04_redis持久化-10"></p>
<ul>
<li>每次修改同步：appendfsync always，同步持久化，每次发生数据变更都会被立即记录到磁盘，性能较差但数据完整性较好。</li>
<li>每秒同步：appendfsync everysec，异步操作，每秒记录，如果一秒内宕机，有数据丢失。</li>
<li>不同步：appendfsync no，从不同步。</li>
</ul>
<h3 id="劣势-1"><a href="#劣势-1" class="headerlink" title="劣势"></a>劣势</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-11.png" alt="04_redis持久化-11"></p>
<ul>
<li>相同数据集的数据而言aof文件要远大于rdb文件，且恢复速度慢于rdb</li>
<li>aof运行效率要慢于rdb，每秒同步策略效率较好，不同步效率和rdb相同。</li>
</ul>
<h3 id="小总结-1"><a href="#小总结-1" class="headerlink" title="小总结"></a>小总结</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-12.png" alt="04_redis持久化-12"></p>
<h2 id="总结（Which-One）"><a href="#总结（Which-One）" class="headerlink" title="总结（Which One）"></a>总结（Which One）</h2><ul>
<li><p>官网建议：</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/04_redis%E6%8C%81%E4%B9%85%E5%8C%96-13.png" alt="04_redis持久化-13"></p>
</li>
<li><p>RDB持久化方式能够在指定的时间间隔内对你的数据进行快照存储。</p>
</li>
<li><p>AOF持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以redis协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。</p>
</li>
<li><p>只做缓存：如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化方式。</p>
</li>
<li><p>同时开启两种持久化方式</p>
<ul>
<li>在这种情况下，<strong>当redis重启的时候回优先载入AOF文件来恢复原始数据</strong>，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集完整。</li>
<li>RDB的数据不实时，同时使用两者时，服务器重启也只会找AOF文件。<strong>那要不要只使用AOF呢？作者建议不要</strong>，因为RDB更适合用于备份数据库（AOF在不断变化，不好备份），快速重启，而且不会有AOF可能存在的Bug，留着作为一个万一的手段。</li>
</ul>
</li>
<li><p>性能建议</p>
<ul>
<li>因为RDB文件只用作后备用途，建议值在slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则。</li>
<li>如果开启了AOF，好处是在最恶劣的情况下也只是会丢失不超过两秒的数据，启动脚本较简单，只load自己的AOF文件就可以了。代价是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到了新文件造成阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设置到5G以上。默认超过原大小100%大小时重写也可以改到适当的数值。</li>
<li>如果不开启AOF，仅靠Master-Slave Replication实现高可用性也可以，能省掉一大笔IO也减少了rewrite时带来的系统波动。代价是如果master/slave同时挂掉，会丢失十几分钟的数据，启动脚本也要比较两个master/slave中的RDB文件，载入较新的那个，新浪微博就采用了这种架构。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/07/Redis/03_Redis_%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/07/Redis/03_Redis_%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">03_Redis_解析配置文件</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-07 15:06:48" itemprop="dateCreated datePublished" datetime="2019-08-07T15:06:48+08:00">2019-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 11:58:58" itemprop="dateModified" datetime="2020-02-16T11:58:58+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="03-Redis-解析配置文件"><a href="#03-Redis-解析配置文件" class="headerlink" title="03_Redis_解析配置文件"></a>03_Redis_解析配置文件</h1><h2 id="1-配置文件的位置"><a href="#1-配置文件的位置" class="headerlink" title="1. 配置文件的位置"></a>1. 配置文件的位置</h2><h3 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h3><p>在redis解压目录下就有一个redis.conf文件，最好拷贝出来使用。</p>
<h2 id="为什么要拷贝出来使用"><a href="#为什么要拷贝出来使用" class="headerlink" title="为什么要拷贝出来使用"></a>为什么要拷贝出来使用</h2><p>并不能保证一次就能修改正确，且可能需要配置不一样的情况。</p>
<h2 id="2-Units单位"><a href="#2-Units单位" class="headerlink" title="2. Units单位"></a>2. Units单位</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1.png" alt="03_redis配置文件-1"></p>
<h2 id="3-INCLUDES包含"><a href="#3-INCLUDES包含" class="headerlink" title="3. INCLUDES包含"></a>3. INCLUDES包含</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-2.png" alt="03_redis配置文件-2"></p>
<h2 id="4-GENERAL通用"><a href="#4-GENERAL通用" class="headerlink" title="4. GENERAL通用"></a>4. GENERAL通用</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-3.png" alt="03_redis配置文件-3"></p>
<ul>
<li><p>Daemonize</p>
</li>
<li><p>Pidfile</p>
</li>
<li><p>Port</p>
</li>
<li><p>Tcp-backlog</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-4.png" alt="03_redis配置文件-4"></p>
</li>
<li><p>Timeout</p>
</li>
<li><p>Bind</p>
</li>
<li><p>Tcp-keepalive</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-5.png" alt="03_redis配置文件-5"></p>
</li>
<li><p>Loglevel</p>
</li>
<li><p>Logfile</p>
</li>
<li><p>Syslog-enabled</p>
<p>是否把日志输出到syslog中</p>
</li>
<li><p>Syslog-ident</p>
<p>指定syslog里的日志标志</p>
</li>
<li><p>Syslog-facility</p>
<p>指定syslog设备，值可以是USER或LOCAL0-LOCAL7</p>
</li>
<li><p>Databases</p>
<p>库的个数，默认16个库</p>
</li>
</ul>
<h2 id="5-SNAPSHOTTING快照"><a href="#5-SNAPSHOTTING快照" class="headerlink" title="5. SNAPSHOTTING快照"></a>5. SNAPSHOTTING快照</h2><ol>
<li><p>save</p>
<ul>
<li><p>save秒钟，写操作次数</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-6.png" alt="03_redis配置文件-6"></p>
</li>
<li><p>禁用</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-7.png" alt="03_redis配置文件-7"></p>
</li>
</ul>
</li>
<li><p>stop-writes-on-bgsave-error</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-8.png" alt="03_redis配置文件-8"></p>
</li>
<li><p>rdbcompression</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-9.png" alt="03_redis配置文件-9"></p>
</li>
<li><p>rdbchecksum</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-10.png" alt="03_redis配置文件-10"></p>
</li>
<li><p>dbfilename</p>
<p>文件名</p>
</li>
<li><p>dir</p>
<p>目录</p>
</li>
</ol>
<h2 id="6-REPLICATION复制"><a href="#6-REPLICATION复制" class="headerlink" title="6. REPLICATION复制"></a>6. REPLICATION复制</h2><h2 id="7-SECURITY安全"><a href="#7-SECURITY安全" class="headerlink" title="7. SECURITY安全"></a>7. SECURITY安全</h2><p>访问密码的查看、设置和取消；</p>
<p>redis-cli连接上后，可以通过<code>config get requirepass</code>查看密码，也可以用<code>config set requirepass &quot;密码&quot;</code>来设定密码，这时候再用<code>ping</code>则会弹出需要你输入密码的提示。这时候用<code>auto 密码</code>即可再次<code>ping</code>通。</p>
<h2 id="8-LIMITS限制"><a href="#8-LIMITS限制" class="headerlink" title="8. LIMITS限制"></a>8. LIMITS限制</h2><p>高版本为CLIENTS等。</p>
<h3 id="CLIENTS"><a href="#CLIENTS" class="headerlink" title="CLIENTS"></a>CLIENTS</h3><ul>
<li>maxclients 10000</li>
</ul>
<h3 id="MEMORY-MANAGEMENT"><a href="#MEMORY-MANAGEMENT" class="headerlink" title="MEMORY MANAGEMENT"></a>MEMORY MANAGEMENT</h3><ul>
<li><p>maxmemory &lt;bytes&gt;</p>
</li>
<li><p>maxmemory-policy noeviction</p>
<p>超过最大内存【maxmemory】的时候，使用过期策略。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> volatile-lru -&gt; Evict using approximated LRU among the keys with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-lru -&gt; Evict any key using approximated LRU.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-lfu -&gt; Evict any key using approximated LFU.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-random -&gt; Remove a random key among the ones with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-random -&gt; Remove a random key, any key.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> noeviction -&gt; Don<span class="string">'t evict anything, just return an error on write operations.</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-11.png" alt="03_redis配置文件-11"></p>
<ul>
<li>noeviction：永不过期</li>
</ul>
</li>
<li><p>maxmemory-samples 5</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-12.png" alt="03_redis配置文件-12"></p>
</li>
<li><p>replica-ignore-maxmemory yes</p>
</li>
</ul>
<h2 id="9-APPEND-ONLY-MODE追加"><a href="#9-APPEND-ONLY-MODE追加" class="headerlink" title="9. APPEND ONLY MODE追加"></a>9. APPEND ONLY MODE追加</h2><ul>
<li><p>appendonly yes/no ：是否开启aof配置</p>
</li>
<li><p>appendfilename 文件名</p>
</li>
<li><p>appendfsync</p>
<p>同步策略：</p>
<ul>
<li>always：同步持久化，每次发生数据变更都会被立即记录到磁盘，性能较差，但是数据完整性比较好；</li>
<li>everysec：<strong>出厂默认推荐</strong>，异步操作，每秒记录，如果一秒内宕机，会有数据丢失；</li>
<li>No：从不；</li>
</ul>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-13.png" alt="03_redis配置文件-13"></p>
</li>
<li><p>no-appendfsync-on-rewrite：重写时是否可以运用appendfsync，用默认no即可，保证数据安全性。</p>
</li>
<li><p>auto-aof-rewrite-min-size：设置重写的基准值，</p>
</li>
<li><p>auto-aof-rewrite-percentage：设置重写的基准值，</p>
</li>
</ul>
<h2 id="10-常见配置redis-conf介绍"><a href="#10-常见配置redis-conf介绍" class="headerlink" title="10. 常见配置redis.conf介绍"></a>10. 常见配置redis.conf介绍</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-14.png" alt="03_redis配置文件-14"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-15.png" alt="03_redis配置文件-15"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-16.png" alt="03_redis配置文件-16"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-17.png" alt="03_redis配置文件-17"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-18.png" alt="03_redis配置文件-18"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-19.png" alt="03_redis配置文件-19"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-20.png" alt="03_redis配置文件-20"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/03_redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-21.png" alt="03_redis配置文件-21"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/06/Redis/02_Redis_%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/06/Redis/02_Redis_%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">02_Redis_入门介绍</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-06 14:40:46" itemprop="dateCreated datePublished" datetime="2019-08-06T14:40:46+08:00">2019-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 11:48:44" itemprop="dateModified" datetime="2020-02-16T11:48:44+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="02-Redis-入门介绍"><a href="#02-Redis-入门介绍" class="headerlink" title="02_Redis_入门介绍"></a>02_Redis_入门介绍</h1><h2 id="入门概述"><a href="#入门概述" class="headerlink" title="入门概述"></a>入门概述</h2><h3 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-1.png" alt="02_redis入门介绍-1"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-2.png" alt="02_redis入门介绍-2"></p>
<h3 id="能干嘛"><a href="#能干嘛" class="headerlink" title="能干嘛"></a>能干嘛</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-3.png" alt="02_redis入门介绍-3"></p>
<h3 id="去哪下"><a href="#去哪下" class="headerlink" title="去哪下"></a>去哪下</h3><p><a href="http://redis.io" target="_blank" rel="noopener">http://redis.io</a></p>
<p><a href="http://www.redis.cn" target="_blank" rel="noopener">http://www.redis.cn</a></p>
<h3 id="怎么玩"><a href="#怎么玩" class="headerlink" title="怎么玩"></a>怎么玩</h3><ul>
<li>数据类型、基本操作和配置</li>
<li>持久化和复制，RDB/AOF</li>
<li>事务的控制</li>
<li>复制</li>
<li>……</li>
</ul>
<h2 id="VMWare-VMTools"><a href="#VMWare-VMTools" class="headerlink" title="VMWare+VMTools"></a>VMWare+VMTools</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-4.png" alt="02_redis入门介绍-4"></p>
<h2 id="Redis的安装"><a href="#Redis的安装" class="headerlink" title="Redis的安装"></a>Redis的安装</h2><h3 id="Windows版安装"><a href="#Windows版安装" class="headerlink" title="Windows版安装"></a>Windows版安装</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-5.png" alt="02_redis入门介绍-5"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-6.png" alt="02_redis入门介绍-6"></p>
<h3 id="重要提示："><a href="#重要提示：" class="headerlink" title="重要提示："></a>重要提示：</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-7.png" alt="02_redis入门介绍-7"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-8.png" alt="02_redis入门介绍-8"></p>
<h3 id="Linux版安装"><a href="#Linux版安装" class="headerlink" title="Linux版安装"></a>Linux版安装</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-9.png" alt="02_redis入门介绍-9"></p>
<ol>
<li><p>下载获得redis.tar.gz后将它放入我们的Linux目录/opt</p>
</li>
<li><p>/opt目录下，解压命令<code>tar -zxvf redis-xxx.tar.gz</code></p>
</li>
<li><p>解压完成后出现文件夹：redis-xxx</p>
</li>
<li><p>进入目录：<code>cd redis-xxx</code></p>
</li>
<li><p>在redis目录下执行make命令</p>
<ul>
<li><p>make报错，没有gcc</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-10.png" alt="02_redis入门介绍-10"></p>
<p><strong>安装gcc：</strong></p>
<p>能上网：yum install gcc-c++</p>
<p>查看gcc版本：</p>
<p>gcc -v</p>
</li>
<li><p>二次make，没有Jemalloc/jemalloc.h没有那个文件或目录</p>
<p>运行make distclean之后再make</p>
</li>
<li><p>Redis Test(可以不用执行)</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-11.png" alt="02_redis入门介绍-11"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-12.png" alt="02_redis入门介绍-12"></p>
</li>
</ul>
</li>
<li><p>如果make完成后继续执行make install</p>
</li>
<li><p>查看默认安装目录：usr/local/bin</p>
</li>
<li><p>启动</p>
<ul>
<li><p>在根目录创建myredis文件夹，放配置文件</p>
<p><code>cp redis.conf /myredis</code></p>
</li>
<li><p>修改配置：</p>
<ul>
<li>deamonize yes    pid文件在/var/run/redis.pid。</li>
<li><strong>protected-mode no</strong>否则外部无法连接上Redis。</li>
</ul>
</li>
</ul>
</li>
<li><p>永远的helloworld</p>
<p><code>redis-server /myredis/redis.conf</code></p>
<p><code>redis-cli -p 6379</code></p>
<p><code>shutdown 从客户端关闭redis</code></p>
</li>
<li><p>关闭</p>
</li>
</ol>
<h3 id="Redis启动后杂项基础知识讲解"><a href="#Redis启动后杂项基础知识讲解" class="headerlink" title="Redis启动后杂项基础知识讲解"></a>Redis启动后杂项基础知识讲解</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-13.png" alt="02_redis入门介绍-13"></p>
<ol>
<li><p>单进程；</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-14.png" alt="02_redis入门介绍-14"></p>
</li>
<li><p>select+角标命令切换数据库；</p>
<p>默认16个库，<code>select 0</code>—-<code>select 15</code></p>
</li>
<li><p>Dbsize查看当前数据库key的数量；</p>
</li>
<li><p>Flushdb：清空当前库</p>
</li>
<li><p>Flushall：清空所有库</p>
</li>
<li><p>统一密码管理：16个库都是同样密码，要么都ok要么一个也连接不上</p>
</li>
<li><p>Redis索引都是从0开始</p>
</li>
<li><p>为什么默认是6379端口</p>
<p>merz意大利歌手</p>
</li>
</ol>
<h2 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h2><h3 id="Redis的五大数据类型"><a href="#Redis的五大数据类型" class="headerlink" title="Redis的五大数据类型"></a>Redis的五大数据类型</h3><h4 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-15.png" alt="02_redis入门介绍-15"></p>
<h4 id="Hash（哈希，类似Java里的Map）"><a href="#Hash（哈希，类似Java里的Map）" class="headerlink" title="Hash（哈希，类似Java里的Map）"></a>Hash（哈希，类似Java里的Map）</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-16.png" alt="02_redis入门介绍-16"></p>
<h4 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-17.png" alt="02_redis入门介绍-17"></p>
<h4 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-18.png" alt="02_redis入门介绍-18"></p>
<h4 id="Zset（sorted-set：有序集合）"><a href="#Zset（sorted-set：有序集合）" class="headerlink" title="Zset（sorted set：有序集合）"></a>Zset（sorted set：有序集合）</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-19.png" alt="02_redis入门介绍-19"></p>
<h3 id="哪里去获得Redis常见数据类型操作命令"><a href="#哪里去获得Redis常见数据类型操作命令" class="headerlink" title="哪里去获得Redis常见数据类型操作命令"></a>哪里去获得Redis常见数据类型操作命令</h3><p><a href="http://redisdoc.com" target="_blank" rel="noopener">网站</a></p>
<h3 id="Redis键-key"><a href="#Redis键-key" class="headerlink" title="Redis键(key)"></a>Redis键(key)</h3><h4 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h4><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-del.html" target="_blank" rel="noopener">DEL key</a> 该命令用于在 key 存在时删除 key。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-dump.html" target="_blank" rel="noopener">DUMP key</a>  序列化给定 key ，并返回被序列化的值。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-exists.html" target="_blank" rel="noopener">EXISTS key</a>  检查给定 key 是否存在。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-expire.html" target="_blank" rel="noopener">EXPIRE key</a> seconds 为给定 key 设置过期时间，以秒计。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-expireat.html" target="_blank" rel="noopener">EXPIREAT key timestamp</a>  EXPIREAT 的作用和 EXPIRE 类似，都用于为 key 设置过期时间。 不同在于 EXPIREAT 命令接受的时间参数是 UNIX 时间戳(unix timestamp)。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-pexpire.html" target="_blank" rel="noopener">PEXPIRE key milliseconds</a>  设置 key 的过期时间以毫秒计。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-pexpireat.html" target="_blank" rel="noopener">PEXPIREAT key milliseconds-timestamp</a>  设置 key 过期时间的时间戳(unix timestamp) 以毫秒计</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-keys.html" target="_blank" rel="noopener">KEYS pattern</a>  查找所有符合给定模式( pattern)的 key 。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-move.html" target="_blank" rel="noopener">MOVE key db</a>  将当前数据库的 key 移动到给定的数据库 db 当中。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-persist.html" target="_blank" rel="noopener">PERSIST key</a>  移除 key 的过期时间，key 将持久保持。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-pttl.html" target="_blank" rel="noopener">PTTL key</a>  以毫秒为单位返回 key 的剩余的过期时间。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-ttl.html" target="_blank" rel="noopener">TTL key</a>  以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-randomkey.html" target="_blank" rel="noopener">RANDOMKEY</a>  从当前数据库中随机返回一个 key 。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-rename.html" target="_blank" rel="noopener">RENAME key newkey</a>  修改 key 的名称</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-renamenx.html" target="_blank" rel="noopener">RENAMENX key newkey</a>  仅当 newkey 不存在时，将 key 改名为 newkey 。</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a href="https://www.runoob.com/redis/keys-type.html" target="_blank" rel="noopener">TYPE key</a>  返回 key 所储存的值的类型。</td>
</tr>
</tbody></table>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><ul>
<li>keys *</li>
<li>exists key的名字，判断某个key 是否存在</li>
<li>move key db —&gt; 移到其他库</li>
<li>expire key 秒钟：为给定key设置过期时间</li>
<li>ttl key：查看还有多少秒过期，-1表示不过期，-2表示已经过期</li>
<li>type key：查看key的类型</li>
</ul>
<h3 id="Redis字符串-String"><a href="#Redis字符串-String" class="headerlink" title="Redis字符串(String)"></a>Redis字符串(String)</h3><p>单值单value</p>
<h4 id="常用-1"><a href="#常用-1" class="headerlink" title="常用"></a>常用</h4><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-set.html" target="_blank" rel="noopener">SET key value</a>  设置指定 key 的值</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-get.html" target="_blank" rel="noopener">GET key</a>  获取指定 key 的值。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-getrange.html" target="_blank" rel="noopener">GETRANGE key start end</a>  返回 key 中字符串值的子字符</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-getset.html" target="_blank" rel="noopener">GETSET key value</a> 将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-getbit.html" target="_blank" rel="noopener">GETBIT key offset</a> 对 key 所储存的字符串值，获取指定偏移量上的位(bit)。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-mget.html" target="_blank" rel="noopener">MGET key1 [key2..]</a> 获取所有(一个或多个)给定 key 的值。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-setbit.html" target="_blank" rel="noopener">SETBIT key offset value</a> 对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-setex.html" target="_blank" rel="noopener">SETEX key seconds value</a> 将值 value 关联到 key ，并将 key 的过期时间设为 seconds (以秒为单位)。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-setnx.html" target="_blank" rel="noopener">SETNX key value</a> 只有在 key 不存在时设置 key 的值。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-setrange.html" target="_blank" rel="noopener">SETRANGE key offset value</a> 用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-strlen.html" target="_blank" rel="noopener">STRLEN key</a> 返回 key 所储存的字符串值的长度。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-mset.html" target="_blank" rel="noopener">MSET key value [key value …]</a> 同时设置一个或多个 key-value 对。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-msetnx.html" target="_blank" rel="noopener">MSETNX key value [key value …]</a>  同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-psetex.html" target="_blank" rel="noopener">PSETEX key milliseconds value</a> 这个命令和 SETEX 命令相似，但它以毫秒为单位设置 key 的生存时间，而不是像 SETEX 命令那样，以秒为单位。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-incr.html" target="_blank" rel="noopener">INCR key</a> 将 key 中储存的数字值增一。</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-incrby.html" target="_blank" rel="noopener">INCRBY key increment</a> 将 key 所储存的值加上给定的增量值（increment） 。</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-incrbyfloat.html" target="_blank" rel="noopener">INCRBYFLOAT key increment</a> 将 key 所储存的值加上给定的浮点增量值（increment） 。</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-decr.html" target="_blank" rel="noopener">DECR key</a> 将 key 中储存的数字值减一。</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-decrby.html" target="_blank" rel="noopener">DECRBY key decrement</a> key 所储存的值减去给定的减量值（decrement） 。</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><a href="https://www.runoob.com/redis/strings-append.html" target="_blank" rel="noopener">APPEND key value</a> 如果 key 已经存在并且是一个字符串， APPEND 命令将指定的 value 追加到该 key 原来值（value）的末尾。</td>
</tr>
</tbody></table>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><ul>
<li>set/get/del/append/strlen</li>
<li>Incr/decr/incrby/decrby：一定要是数字才可以加减</li>
<li>gentrange（0到-1表示全部）/setrange</li>
<li>setex(set with expire)键秒值/setnx(set if not exist)</li>
<li>mset/mget/msetnx批量操作m是more的意思，msetnx所有成功才成功</li>
<li>getset（先get再set）</li>
</ul>
<h3 id="Redis列表-List"><a href="#Redis列表-List" class="headerlink" title="Redis列表(List)"></a>Redis列表(List)</h3><p>单值多value</p>
<h4 id="常用-2"><a href="#常用-2" class="headerlink" title="常用"></a>常用</h4><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-blpop.html" target="_blank" rel="noopener">BLPOP key1 [key2 ] timeout</a>  移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-brpop.html" target="_blank" rel="noopener">BRPOP key1 [key2 ] timeout</a>  移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-brpoplpush.html" target="_blank" rel="noopener">BRPOPLPUSH source destination timeout</a>  从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lindex.html" target="_blank" rel="noopener">LINDEX key index</a>  通过索引获取列表中的元素</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-linsert.html" target="_blank" rel="noopener">LINSERT key BEFORE|AFTER pivot value</a>  在列表的元素前或者后插入元素</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-llen.html" target="_blank" rel="noopener">LLEN key</a>  获取列表长度</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lpop.html" target="_blank" rel="noopener">LPOP key</a>  移出并获取列表的第一个元素</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lpush.html" target="_blank" rel="noopener">LPUSH key value1 [value2]</a>  将一个或多个值插入到列表头部</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lpushx.html" target="_blank" rel="noopener">LPUSHX key value</a>  将一个值插入到已存在的列表头部</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lrange.html" target="_blank" rel="noopener">LRANGE key start stop</a>  获取列表指定范围内的元素</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lrem.html" target="_blank" rel="noopener">LREM key count value</a>  移除列表元素</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-lset.html" target="_blank" rel="noopener">LSET key index value</a>  通过索引设置列表元素的值</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-ltrim.html" target="_blank" rel="noopener">LTRIM key start stop</a>  对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-rpop.html" target="_blank" rel="noopener">RPOP key</a>  移除列表的最后一个元素，返回值为移除的元素。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-rpoplpush.html" target="_blank" rel="noopener">RPOPLPUSH source destination</a>  移除列表的最后一个元素，并将该元素添加到另一个列表并返回</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-rpush.html" target="_blank" rel="noopener">RPUSH key value1 [value2]</a>  在列表中添加一个或多个值</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a href="https://www.runoob.com/redis/lists-rpushx.html" target="_blank" rel="noopener">RPUSHX key value</a>  为已存在的列表添加值</td>
</tr>
</tbody></table>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><ul>
<li>lpush/rpush/lrange</li>
<li>lpop/rpop</li>
<li>lindex，按照索引获得元素，从上到下，可以想象成从左到右</li>
<li>llen</li>
<li>lrem key 删n个value，lrem list01 5 1（删除5个1）</li>
<li>ltrim key 开始index 结束index，截取指定范围的值后再赋值给key</li>
<li>rpoplpush 源列表 目的列表</li>
<li>lset key index value</li>
<li>linsert key before/after 值1 值2</li>
</ul>
<h4 id="性能总结"><a href="#性能总结" class="headerlink" title="性能总结"></a>性能总结</h4><ul>
<li>是一个字符串链表，left、right都可以插入添加；</li>
<li>如果键不存在，创建新的链表；</li>
<li>如果键已存在，新增内容；</li>
<li>如果值全移除，对应的键也就消失了。</li>
<li>链表的操作无论是头和尾效率都极高，但假如是对中间元素进行操作，效率就惨淡了。</li>
</ul>
<h3 id="Redis集合-Set"><a href="#Redis集合-Set" class="headerlink" title="Redis集合(Set)"></a>Redis集合(Set)</h3><p>单值多value</p>
<h4 id="常用-3"><a href="#常用-3" class="headerlink" title="常用"></a>常用</h4><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sadd.html" target="_blank" rel="noopener">SADD key member1 [member2]</a>  向集合添加一个或多个成员</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-scard.html" target="_blank" rel="noopener">SCARD key</a>  获取集合的成员数</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sdiff.html" target="_blank" rel="noopener">SDIFF key1 [key2]</a>  返回给定所有集合的差集</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sdiffstore.html" target="_blank" rel="noopener">SDIFFSTORE destination key1 [key2]</a>  返回给定所有集合的差集并存储在 destination 中</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sinter.html" target="_blank" rel="noopener">SINTER key1 [key2]</a>  返回给定所有集合的交集</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sinterstore.html" target="_blank" rel="noopener">SINTERSTORE destination key1 [key2]</a>  返回给定所有集合的交集并存储在 destination 中</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sismember.html" target="_blank" rel="noopener">SISMEMBER key member</a>  判断 member 元素是否是集合 key 的成员</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-smembers.html" target="_blank" rel="noopener">SMEMBERS key</a>  返回集合中的所有成员</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-smove.html" target="_blank" rel="noopener">SMOVE source destination member</a>  将 member 元素从 source 集合移动到 destination 集合</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-spop.html" target="_blank" rel="noopener">SPOP key</a>  移除并返回集合中的一个随机元素</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-srandmember.html" target="_blank" rel="noopener">SRANDMEMBER key [count]</a>  返回集合中一个或多个随机数</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-srem.html" target="_blank" rel="noopener">SREM key member1 [member2]</a>  移除集合中一个或多个成员</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sunion.html" target="_blank" rel="noopener">SUNION key1 [key2]</a>  返回所有给定集合的并集</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sunionstore.html" target="_blank" rel="noopener">SUNIONSTORE destination key1 [key2]</a>  所有给定集合的并集存储在 destination 集合中</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a href="https://www.runoob.com/redis/sets-sscan.html" target="_blank" rel="noopener">SSCAN key cursor [MATCH pattern] [COUNT count]</a>  迭代集合中的元素</td>
</tr>
</tbody></table>
<h4 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h4><ul>
<li>sadd/smemebers/sismember</li>
<li>scard，获取集合里面的元素个数</li>
<li>srem key value删除集合中的元素</li>
<li>srandmember key某个整数（随机出几个数）</li>
<li>spop key随机出栈</li>
<li>smove key1 key2 在key1里的某个值赋给key2</li>
<li>数学集合类<ul>
<li>差集：sdiff</li>
<li>交集：sinter</li>
<li>并集：sunion</li>
</ul>
</li>
</ul>
<h3 id="Redis哈希-Hash"><a href="#Redis哈希-Hash" class="headerlink" title="Redis哈希(Hash)"></a>Redis哈希(Hash)</h3><p>KV模式不变，但V是一个键值对</p>
<h4 id="常用-4"><a href="#常用-4" class="headerlink" title="常用"></a>常用</h4><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hdel.html" target="_blank" rel="noopener">HDEL key field1 [field2]</a>  删除一个或多个哈希表字段</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hexists.html" target="_blank" rel="noopener">HEXISTS key field</a>  查看哈希表 key 中，指定的字段是否存在。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hget.html" target="_blank" rel="noopener">HGET key field</a>  获取存储在哈希表中指定字段的值。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hgetall.html" target="_blank" rel="noopener">HGETALL key</a>  获取在哈希表中指定 key 的所有字段和值</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hincrby.html" target="_blank" rel="noopener">HINCRBY key field increment</a>  为哈希表 key 中的指定字段的整数值加上增量 increment 。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hincrbyfloat.html" target="_blank" rel="noopener">HINCRBYFLOAT key field increment</a>  为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hkeys.html" target="_blank" rel="noopener">HKEYS key</a>  获取所有哈希表中的字段</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hlen.html" target="_blank" rel="noopener">HLEN key</a>  获取哈希表中字段的数量</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hmget.html" target="_blank" rel="noopener">HMGET key field1 [field2]</a>  获取所有给定字段的值</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hmset.html" target="_blank" rel="noopener">HMSET key field1 value1 [field2 value2 ]</a>  同时将多个 field-value (域-值)对设置到哈希表 key 中。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hset.html" target="_blank" rel="noopener">HSET key field value</a>  将哈希表 key 中的字段 field 的值设为 value 。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hsetnx.html" target="_blank" rel="noopener">HSETNX key field value</a>  只有在字段 field 不存在时，设置哈希表字段的值。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/redis/hashes-hvals.html" target="_blank" rel="noopener">HVALS key</a>  获取哈希表中所有值</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">HSCAN key cursor [MATCH pattern] [COUNT count]  迭代哈希表中的键值对。</td>
</tr>
</tbody></table>
<h4 id="案例-4"><a href="#案例-4" class="headerlink" title="案例"></a>案例</h4><ul>
<li><strong>hset/hget/hmset/hmget/hgetall/hdel</strong></li>
<li>hlen</li>
<li>hexists key 在key里面的某个值的key</li>
<li><strong>hkeys/hvals</strong></li>
<li>hincrby/hincrbyfloat</li>
<li>hsetnx</li>
</ul>
<h3 id="Redis有序集合Zset-sorted-set"><a href="#Redis有序集合Zset-sorted-set" class="headerlink" title="Redis有序集合Zset(sorted set)"></a>Redis有序集合Zset(sorted set)</h3><p>在set基础上，加一个score值，之前set是k1 v1 v2 v3，现在zset是k1 socre1 v1 score2 v2</p>
<h4 id="常用-5"><a href="#常用-5" class="headerlink" title="常用"></a>常用</h4><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zadd.html" target="_blank" rel="noopener">ZADD key score1 member1 [score2 member2]</a>  向有序集合添加一个或多个成员，或者更新已存在成员的分数</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zcard.html" target="_blank" rel="noopener">ZCARD key</a>  获取有序集合的成员数</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zcount.html" target="_blank" rel="noopener">ZCOUNT key min max</a>  计算在有序集合中指定区间分数的成员数</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zincrby.html" target="_blank" rel="noopener">ZINCRBY key increment member</a>  有序集合中对指定成员的分数加上增量 increment</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zinterstore.html" target="_blank" rel="noopener">ZINTERSTORE destination numkeys key [key …]</a>  计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zlexcount.html" target="_blank" rel="noopener">ZLEXCOUNT key min max</a>  在有序集合中计算指定字典区间内成员数量</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrange.html" target="_blank" rel="noopener">ZRANGE key start stop [WITHSCORES]</a>  通过索引区间返回有序集合成指定区间内的成员</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrangebylex.html" target="_blank" rel="noopener">ZRANGEBYLEX key min max [LIMIT offset count]</a>  通过字典区间返回有序集合的成员</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrangebyscore.html" target="_blank" rel="noopener">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT]</a>  通过分数返回有序集合指定区间内的成员</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrank.html" target="_blank" rel="noopener">ZRANK key member</a>  返回有序集合中指定成员的索引</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrem.html" target="_blank" rel="noopener">ZREM key member [member …]</a>  移除有序集合中的一个或多个成员</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zremrangebylex.html" target="_blank" rel="noopener">ZREMRANGEBYLEX key min max</a>  移除有序集合中给定的字典区间的所有成员</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zremrangebyrank.html" target="_blank" rel="noopener">ZREMRANGEBYRANK key start stop</a>  移除有序集合中给定的排名区间的所有成员</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zremrangebyscore.html" target="_blank" rel="noopener">ZREMRANGEBYSCORE key min max</a>  移除有序集合中给定的分数区间的所有成员</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrevrange.html" target="_blank" rel="noopener">ZREVRANGE key start stop [WITHSCORES]</a>  返回有序集中指定区间内的成员，通过索引，分数从高到底</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrevrangebyscore.html" target="_blank" rel="noopener">ZREVRANGEBYSCORE key max min [WITHSCORES]</a>  返回有序集中指定分数区间内的成员，分数从高到低排序</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zrevrank.html" target="_blank" rel="noopener">ZREVRANK key member</a>  返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zscore.html" target="_blank" rel="noopener">ZSCORE key member</a>  返回有序集中，成员的分数值</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zunionstore.html" target="_blank" rel="noopener">ZUNIONSTORE destination numkeys key [key …]</a>  计算给定的一个或多个有序集的并集，并存储在新的 key 中</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><a href="https://www.runoob.com/redis/sorted-sets-zscan.html" target="_blank" rel="noopener">ZSCAN key cursor [MATCH pattern] [COUNT count]</a>  迭代有序集合中的元素（包括元素成员和元素分值）</td>
</tr>
</tbody></table>
<h4 id="案例-5"><a href="#案例-5" class="headerlink" title="案例"></a>案例</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/02_redis%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D-20.png" alt="02_redis入门介绍-20"></p>
<ul>
<li>zadd/zrange zrange最后可以加withscores</li>
<li>zrangebyscore key 开始score 结束score<ul>
<li>withscores</li>
<li>(score 不包含，即开区间</li>
<li>limit作用是返回限制，limit  开始index 多少步，类似分页</li>
</ul>
</li>
<li>zrem key 某score下对应的value值，作用是删除元素</li>
<li>zcard/zcount key score区间/zrank key values值，作用是获得下标值/zscore key对应值，获得分数</li>
<li>zrevrank key values值，作用是逆序获得下标值</li>
<li>zrevrange</li>
<li>zrevrangebyscore key <strong>结束score 开始score</strong></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/06/Redis/01_Redis_NoSQL%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/06/Redis/01_Redis_NoSQL%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">01_Redis_NoSQL入门概述</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-06 09:02:06" itemprop="dateCreated datePublished" datetime="2019-08-06T09:02:06+08:00">2019-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-16 11:37:36" itemprop="dateModified" datetime="2020-02-16T11:37:36+08:00">2020-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/" itemprop="url" rel="index">
                    <span itemprop="name">NoSQL</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NoSQL/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="01-Redis-NoSQL入门概述"><a href="#01-Redis-NoSQL入门概述" class="headerlink" title="01_Redis_NoSQL入门概述"></a>01_Redis_NoSQL入门概述</h1><h2 id="入门概述"><a href="#入门概述" class="headerlink" title="入门概述"></a>入门概述</h2><h3 id="1、互联网时代背景下大机遇，为什么用nosql"><a href="#1、互联网时代背景下大机遇，为什么用nosql" class="headerlink" title="1、互联网时代背景下大机遇，为什么用nosql"></a>1、互联网时代背景下大机遇，为什么用nosql</h3><ol>
<li><p>单机MySQL的美好年代</p>
<p>在90年代,一个网站的访问量并不大，用单个数据库完全可以轻松应付。</p>
<p>在那个时候，更多的都是静态网页，动态交互类型的网站不多。</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-1.png" alt="01_NoSql入门概述-1"></p>
<p>上述架构下，我们来看看数据存储的瓶颈是什么？</p>
<ul>
<li>数据量的总大小，一个机器放不下的时候。</li>
<li>数据的索引（B+Tree），一个机器的内存放不下的时候。</li>
<li>访问量（读写混合），一个实例不能承受的时候。</li>
</ul>
</li>
<li><p>Memcached(缓存)+MySQL+垂直拆分</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-2.png" alt="01_NoSql入门概述-2"></p>
</li>
<li><p>MySQL主从读写分离</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-3.png" alt="01_NoSql入门概述-3"></p>
</li>
<li><p>分表分库+水平拆分+MySQL集群</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-4.png" alt="01_NoSql入门概述-4"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-5.png" alt="01_NoSql入门概述-5"></p>
</li>
<li><p>MySQL的扩展性瓶颈</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-6.png" alt="01_NoSql入门概述-6"></p>
</li>
<li><p>今天是什么样子??</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-7.png" alt="01_NoSql入门概述-7"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-8.png" alt="01_NoSql入门概述-8"></p>
</li>
<li><p>为什么用NoSQL</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-9.png" alt="01_NoSql入门概述-9"></p>
</li>
</ol>
<h3 id="2、是什么"><a href="#2、是什么" class="headerlink" title="2、是什么"></a>2、是什么</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-10.png" alt="01_NoSql入门概述-10"></p>
<h3 id="3、能干嘛"><a href="#3、能干嘛" class="headerlink" title="3、能干嘛"></a>3、能干嘛</h3><ol>
<li><p>易扩展</p>
<p>NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。</p>
<p>数据之间无关系，这样就非常容易扩展，也无形之间在架构的层面上带来了可扩展的能力。</p>
</li>
<li><p>大数据量高性能</p>
<p>NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀，这得益于它的无关系性，数据库的结构简单。</p>
<p>一般MySQL使用Query Cache，每次表的更新Cache就失效，是一种大粒度的Cache，在针对web2.0的交互频繁的应用，Cache性能不高。而NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说就要性能高很多了。</p>
</li>
<li><p>多样灵活的数据模型</p>
<p>NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系型数据库里，增删字段是一件非常麻烦的事前，如果是非常大数据量的表，增加字段简直就是一个噩梦；</p>
</li>
<li><p>传统RDBMS VS NOSQL</p>
<ul>
<li>RDBMS<ul>
<li>高度组织化结构化数据</li>
<li>结构化查询语句（SQL）</li>
<li>数据和关系都存储在单独的表中</li>
<li>数据操纵语言，数据定义语言</li>
<li>严格的一致性</li>
<li>基础事务</li>
</ul>
</li>
<li>NoSQL<ul>
<li>代表着不仅仅是SQL</li>
<li>没有声明性查询语句</li>
<li>没有预定义的模式</li>
<li>键值对存储，列存储，文档存储，图形数据库</li>
<li>最终一致性，而非ACID属性</li>
<li>非结构化和不可预知的数据</li>
<li>CAP定理</li>
<li>高性能、高可用、可伸缩</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="4、去哪下"><a href="#4、去哪下" class="headerlink" title="4、去哪下"></a>4、去哪下</h3><ol>
<li>Redis</li>
<li>Memcache</li>
<li>Mongdb</li>
</ol>
<h3 id="5、怎么玩"><a href="#5、怎么玩" class="headerlink" title="5、怎么玩"></a>5、怎么玩</h3><ol>
<li>KV</li>
<li>Cache</li>
<li>Persistence</li>
<li>……</li>
</ol>
<h2 id="3V-3高"><a href="#3V-3高" class="headerlink" title="3V+3高"></a>3V+3高</h2><h3 id="1、大数据时代的3V"><a href="#1、大数据时代的3V" class="headerlink" title="1、大数据时代的3V"></a>1、大数据时代的3V</h3><ol>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ol>
<h3 id="2、互联网需求的3高"><a href="#2、互联网需求的3高" class="headerlink" title="2、互联网需求的3高"></a>2、互联网需求的3高</h3><ol>
<li>高并发</li>
<li>高可扩</li>
<li>高性能</li>
</ol>
<h2 id="当下的NoSQL经典应用"><a href="#当下的NoSQL经典应用" class="headerlink" title="当下的NoSQL经典应用"></a>当下的NoSQL经典应用</h2><p>当下的应用是sql和NoSQL一起使用</p>
<h3 id="阿里巴巴中文站商品信息如何存放"><a href="#阿里巴巴中文站商品信息如何存放" class="headerlink" title="阿里巴巴中文站商品信息如何存放"></a>阿里巴巴中文站商品信息如何存放</h3><h4 id="看看阿里巴巴中文网站首页，以女装-女包包为例"><a href="#看看阿里巴巴中文网站首页，以女装-女包包为例" class="headerlink" title="看看阿里巴巴中文网站首页，以女装/女包包为例"></a>看看阿里巴巴中文网站首页，以女装/女包包为例</h4><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-11.png" alt="01_NoSql入门概述-11"></p>
<h5 id="架构发展历程"><a href="#架构发展历程" class="headerlink" title="架构发展历程"></a>架构发展历程</h5><ol>
<li><p>演变历程</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-12.png" alt="01_NoSql入门概述-12"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-13.png" alt="01_NoSql入门概述-13"></p>
</li>
<li><p>第5代</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-14.png" alt="01_NoSql入门概述-14"></p>
</li>
<li><p>第5代架构使命</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-15.png" alt="01_NoSql入门概述-15"></p>
</li>
<li><p>……</p>
</li>
</ol>
<h5 id="和我们相关的，多数据源多数据类型的存储问题"><a href="#和我们相关的，多数据源多数据类型的存储问题" class="headerlink" title="和我们相关的，多数据源多数据类型的存储问题"></a>和我们相关的，多数据源多数据类型的存储问题</h5><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-16.png" alt="01_NoSql入门概述-16"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-17.png" alt="01_NoSql入门概述-17"></p>
<h4 id="淘宝商品"><a href="#淘宝商品" class="headerlink" title="淘宝商品"></a>淘宝商品</h4><ol>
<li><p>商品基本信息</p>
<p>名称、价格、出厂日期、生产厂商等。</p>
<p>关系型数据库，MySQL/Oracle目前淘宝在去O化（也就是拿掉Oracle），<strong>注意，淘宝内部用的MySQL是里面的大牛自己改造过的</strong>；</p>
<ul>
<li><p>为什么去IOE</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-18.png" alt="01_NoSql入门概述-18"></p>
</li>
</ul>
</li>
<li><p>商品描述、详情、评价信息（多文字类）</p>
<p>多文字信息描述类，IO读写性能变差，存在文档数据库MongDB中。</p>
</li>
<li><p>商品的图片</p>
<p>商品图片展示类，在分布式的文件系统中：</p>
<ul>
<li>淘宝自己的TFS</li>
<li>Google的GFS</li>
<li>Hadoop的HDFS</li>
</ul>
</li>
<li><p>商品的关键字</p>
<p>搜索引擎，淘宝内部使用ISearch</p>
</li>
<li><p>商品的波段性的热点高频信息</p>
<p>内存数据库：Tair，Redis、Memcache</p>
</li>
<li><p>商品的交易、价格计算、积分累计</p>
<p>外部系统，外部第三方支付接口，支付宝</p>
</li>
<li><p>总结大型互联网应用（大数据、高并发、多样数据类型）的难点和解决方案</p>
<ul>
<li><p>难点</p>
<ul>
<li>数据类型的多样性</li>
<li>数据源多样性和变化重构</li>
<li>数据源改造而数据服务平台不需要大面积重构</li>
</ul>
</li>
<li><p>解决办法</p>
<p>EAI和统一数据平台服务层，阿里淘宝UDSL</p>
<p>类似面向接口编程，提供一个接口去操作多个数据源，统一数据平台服务层。</p>
<p><strong>UDSL：</strong></p>
<ul>
<li><p>是什么</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-19.png" alt="01_NoSql入门概述-19"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-20.png" alt="01_NoSql入门概述-20"></p>
</li>
<li><p>什么样</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-21.png" alt="01_NoSql入门概述-21"></p>
<ol>
<li><p>映射</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-22.png" alt="01_NoSql入门概述-22"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-23.png" alt="01_NoSql入门概述-23"></p>
</li>
<li><p>API</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-24.png" alt="01_NoSql入门概述-24"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-25.png" alt="01_NoSql入门概述-25"></p>
</li>
<li><p>热点缓存</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-26.png" alt="01_NoSql入门概述-26"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-27.png" alt="01_NoSql入门概述-27"></p>
</li>
<li><p>……</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="NoSQL数据模型简介"><a href="#NoSQL数据模型简介" class="headerlink" title="NoSQL数据模型简介"></a>NoSQL数据模型简介</h2><h3 id="以一个电商客户、订单、订购、地址模型来对比下关系型数据库和非关系型数据库"><a href="#以一个电商客户、订单、订购、地址模型来对比下关系型数据库和非关系型数据库" class="headerlink" title="以一个电商客户、订单、订购、地址模型来对比下关系型数据库和非关系型数据库"></a>以一个电商客户、订单、订购、地址模型来对比下关系型数据库和非关系型数据库</h3><ol>
<li><p>传统的关系型数据库你如何设计？</p>
<ul>
<li><p>E-R图（1:1/1:N/N:N，主外键等）</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-28.png" alt="01_NoSql入门概述-28"></p>
</li>
<li><p>NoSQL如何设计</p>
<ul>
<li><p>什么是BSON</p>
<p>BSON()是一种类JSON的一种二进制形式的存储格式，简称Binary JSON，和JSON一样支持内嵌的文档对象和数组对象。</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-29.png" alt="01_NoSql入门概述-29"></p>
</li>
<li><p>两者对比，问题和难点</p>
<ul>
<li><p>为什么上述的情况可以用聚合模型来处理</p>
<p>高并发的操作是不太建议有关联查询的，互联网公司用冗余数据来避免关联查询，分布式事务是支持不了太多的并发的。</p>
</li>
<li><p>关系模型数据库如何查？按照BSON查询</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="聚合模型"><a href="#聚合模型" class="headerlink" title="聚合模型"></a>聚合模型</h3><ol>
<li><p>KV键值对</p>
</li>
<li><p>BSON</p>
</li>
<li><p>列族</p>
<p>顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-30.png" alt="01_NoSql入门概述-30"></p>
</li>
<li><p>图族</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-31.png" alt="01_NoSql入门概述-31"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-32.png" alt="01_NoSql入门概述-32"></p>
</li>
</ol>
<h2 id="NoSQL数据库的四大分类"><a href="#NoSQL数据库的四大分类" class="headerlink" title="NoSQL数据库的四大分类"></a>NoSQL数据库的四大分类</h2><h3 id="KV键值：典型介绍"><a href="#KV键值：典型介绍" class="headerlink" title="KV键值：典型介绍"></a>KV键值：典型介绍</h3><ol>
<li>新浪：BerkeleyDB+redis</li>
<li>美团：redis+tair</li>
<li>阿里、百度：memcache+redis</li>
</ol>
<h3 id="文档型数据库（bson格式比较多）：典型介绍"><a href="#文档型数据库（bson格式比较多）：典型介绍" class="headerlink" title="文档型数据库（bson格式比较多）：典型介绍"></a>文档型数据库（bson格式比较多）：典型介绍</h3><ol>
<li><p>CouchDB</p>
</li>
<li><p>MongoDB</p>
<p>MongoDB是一个<strong>基于分布式文件存储的数据库</strong>，由C++语言编写，旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p>
<p>MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系型数据库当中功能最丰富，最像关系型数据库的。</p>
</li>
</ol>
<h3 id="列存储数据库"><a href="#列存储数据库" class="headerlink" title="列存储数据库"></a>列存储数据库</h3><p>Cassandra，HBase，分布式文件系统</p>
<h3 id="图关系数据库"><a href="#图关系数据库" class="headerlink" title="图关系数据库"></a>图关系数据库</h3><p>不是放图形的，而是放关系，比如：朋友圈社交网络、广告推荐系统、社交网络推荐系统等，专注于构建关系图谱，如Neo4J，InfoGrid</p>
<h3 id="四者对比"><a href="#四者对比" class="headerlink" title="四者对比"></a>四者对比</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-33.png" alt="01_NoSql入门概述-33"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-34.png" alt="01_NoSql入门概述-34"></p>
<h2 id="在分布式数据库中CAP原理CAP-BASE"><a href="#在分布式数据库中CAP原理CAP-BASE" class="headerlink" title="在分布式数据库中CAP原理CAP+BASE"></a>在分布式数据库中CAP原理CAP+BASE</h2><h3 id="传统的ACID分别是什么"><a href="#传统的ACID分别是什么" class="headerlink" title="传统的ACID分别是什么"></a>传统的ACID分别是什么</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-35.png" alt="01_NoSql入门概述-35"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-36.png" alt="01_NoSql入门概述-36"></p>
<h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-37.png" alt="01_NoSql入门概述-37"></p>
<h3 id="CAP的3进2"><a href="#CAP的3进2" class="headerlink" title="CAP的3进2"></a>CAP的3进2</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-38.png" alt="01_NoSql入门概述-38"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-39.png" alt="01_NoSql入门概述-39"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-40.png" alt="01_NoSql入门概述-40"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-41.png" alt="01_NoSql入门概述-41"></p>
<h3 id="经典CAP图"><a href="#经典CAP图" class="headerlink" title="经典CAP图"></a>经典CAP图</h3><p>CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性、可用性和分区容错性这三个需求，<strong>最多只能同时较好的满足两个；</strong></p>
<p>因此，根据CAP原理将NoSQL数据库分成了满足CA原则、满足CP原则和满足AP原则三大类：</p>
<ul>
<li>CA：单点集群，满足一致性、可用性的系统，通常在可扩展性上不太强大；</li>
<li>CP：满足一致性，分区容忍性的系统，通常性能不是特别高；</li>
<li>AP：满足可用性，分区容忍性的系统，通常可能对一致性要求低一点；</li>
</ul>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-42.png" alt="01_NoSql入门概述-42"></p>
<h3 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h3><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/redis/01_NoSql%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0-43.png" alt="01_NoSql入门概述-43"></p>
<h3 id="分布式-集群简介"><a href="#分布式-集群简介" class="headerlink" title="分布式+集群简介"></a>分布式+集群简介</h3><p>分布式系统：</p>
<p>由多台计算机和通信的软件组件通过计算机网络连接（本地网络或广域网）组成。分布式系统是建立在网络之上的软件系统，正式因为软件的特性，所以分布式系统具有高度的内聚性和透明性。因此，网络和分布式系统之间的区别更多在于高层软件（特别是操作系统），而不是硬件。分布式系统可以应用在不同的平台上：PC、工作站、局域网和广域网上等。</p>
<p>简单来讲：</p>
<ol>
<li>分布式：不同的多台服务器上面部署不同的服务模块（工程），他们之间通过RPC/RMI之间通信和调用，对外提供服务和组内协作；</li>
<li>集群：不同的多台服务器上面部署相同的服务模块，通过分布式调度软件进行统一的调度，对外提供服务和访问；</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blog.tomxwd.com/2019/08/05/JVM/JVM1/01_JVM_%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%AD%A6%E4%B9%A0%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="tomxwd">
      <meta itemprop="description" content="tomxwd">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tomxwd.blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/05/JVM/JVM1/01_JVM_%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%AD%A6%E4%B9%A0%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">01_JVM_第一次学习整理</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-05 10:44:18" itemprop="dateCreated datePublished" datetime="2019-08-05T10:44:18+08:00">2019-08-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-15 22:35:41" itemprop="dateModified" datetime="2020-02-15T22:35:41+08:00">2020-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/JVM1/" itemprop="url" rel="index">
                    <span itemprop="name">JVM1</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="01-JVM-第一次学习整理"><a href="#01-JVM-第一次学习整理" class="headerlink" title="01_JVM_第一次学习整理"></a>01_JVM_第一次学习整理</h1><h2 id="JVM-简析"><a href="#JVM-简析" class="headerlink" title="JVM-简析"></a>JVM-简析</h2><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_JVM%E7%BB%84%E6%88%90%E7%BB%93%E6%9E%841.png" alt="01_JVM_JVM组成结构1"></p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_JVM%E7%BB%84%E6%88%90%E7%BB%93%E6%9E%842.png" alt="01_JVM_JVM组成结构2"></p>
<p>Thread.State;</p>
<ol>
<li>NEW：就绪状态</li>
<li>RUNNABLE：运行中</li>
<li>BLOCKED：阻塞</li>
<li>WAITING：等待</li>
<li>TIMED_WAITING：等待一定时间</li>
<li>TERMINATED：终结</li>
</ol>
<p>Java native Interface（JNI）：用底层JVM本地库接口，去调操作系统底层的函数库，说白点就是调用C了；</p>
<ol>
<li><p>Class Loader类加载器</p>
<p>负责加载class文件，class文件在文件开头有特定的文件标示，并且ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。</p>
</li>
<li><p>Native Interface</p>
<p>本地接口的作用是融合不同的编程语言为Java所用，它的初衷是融合C/C++程序，Java诞生的时候是C/C++横行的时候，要想立足，必须要调用C/C++程序，于是就在内存中专门开辟了一块区域处理标记为native方法，它的具体做法是Native Method Stack中登记nativ方法，在Execution Engine执行的时候加载native libraies。</p>
<p>目前该方法使用的越来越少了，除非是与硬件有关的应用，比如通过Java程序驱动打印机，或者Java系统管理生产设备，在企业级应用中已经比较少见了。</p>
<p>因为现在的异构领域间通信很发达，比如可以使用Socket通信，也可以使用WebService等等，不多做介绍。</p>
</li>
<li><p>Method Area 方法区</p>
<p>方法区是被所有线程共享的，所有字段和方法字节码，以及一些特殊方法如构造函数，接口代码也在此定义。</p>
<p>简单说，所有定义的方法的信息都保存在该区域，此区域属于共享区间。</p>
<p><strong>静态变量+常量+类信息+运行时常量池存在方法区中+实例变量存在堆内存中</strong></p>
</li>
<li><p>PC Register程序计数器</p>
<p>每个线程都有一个程序计数器，就是一个指针，指向方法中的方法字节码（下一个将要执行的指令代码），由执行引擎读取下一条指令，是一个非常小的内存空间，几乎可以忽略不计。</p>
</li>
<li><p>Native Method Stack 本地方法栈</p>
<p>它的具体做法是Native Method Stack中登记native方法，在Execution Engine执行时加载native libraies。</p>
</li>
<li><p>Stack栈是什么</p>
<p>栈也叫栈内存，主管Java程序的运行，是在线程创建时创建，它的生命期是跟随线程的生命期，线程结束栈内存也就释放，<strong>对于栈来说不存在垃圾回收问题</strong>，因为只要线程一结束该栈就Over，生命周期和线程一致，是线程私有的。<strong>基本类型的变量和对象的引用变量都是在函数的栈内存中分配</strong>；</p>
<ul>
<li><p>栈存储什么？</p>
<p>栈帧中主要保存三类数据：</p>
<ul>
<li>本地变量（Local Variables）：输入参数和输出参数以及方法内的变量；</li>
<li>栈操作（Operand Stack）：记录出栈、入栈的操作；</li>
<li>栈帧数据（Frame Data）：包括类文件、方法等等；</li>
</ul>
</li>
<li><p>栈运行原理：</p>
<p>栈中的数据都是以栈帧（Stack Frame）的格式存在，栈帧是一个内存区块，是一个数据集，是一个有关方法（Method）和运行期数据的数据集，当一个方法A被调用的时候就产生一个栈帧F1，并被压入栈中，A方法又调用B方法，于是产生栈帧F2也被压入栈，B方法又调用了C方法，于是产生栈帧F3也被压入栈……执行完毕后，先弹出F3栈帧，再弹出F2栈帧，再弹出F1栈帧……</p>
<p>遵循<strong>“先进后出”/“后进先出”</strong>的原则；</p>
</li>
</ul>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_JavaStack%E5%9B%BE.png" alt="01_JVM_JavaStack图"></p>
<ul>
<li><p>java.lang.StackOverflowError</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_JavaStack%E5%9B%BE2.png" alt="01_JVM_JavaStack图2"></p>
<ul>
<li><p>判断JVM优化是哪里？<br><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE.png" alt="01_JVM_JVM运行时数据"></p>
</li>
<li><p>三种JVM</p>
</li>
<li><p>Sun公司的HotSpot；</p>
</li>
<li><p>BEA公司的JRockit；</p>
</li>
<li><p>IBM公司的J9 VM；</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Heap堆</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_%E5%A0%86%E5%86%85%E5%AD%98%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="01_JVM_堆内存示意图"></p>
<p>一个JVM实例只存在一个堆内存，堆内存的大小是可以调节的。类加载器读取了类文件之后，需要把类、方法、常变量放到堆内存中，保存所有的引用类型的真实信息，以方便执行器执行，堆内存分为三部分：</p>
<ul>
<li><p>Young Generation Space 新生区     Young</p>
<p>新生去是类的诞生、成长、消亡的区域，一个类在这里产生，应用，最后被垃圾回收器收集，结束生命。新生区又分为两部分：伊甸区（Eden space）和幸存区（Survivor space），所有的类都是在伊甸区被new出来的。</p>
<p>幸存区有两个：0区（Survivor 0 space）和1区（Survivor 1 space）。当伊甸区的空间被用完时，程序又需要创建对象，JVM的垃圾回收器将对伊甸区进行垃圾回收（Minor GC），将伊甸区中的不再被其他对象所引用的对象进行销毁，然后将伊甸区中的剩余对象移动到幸存0区。若幸存0区也满了，再对该区进行垃圾回收，然后移动到1区。那如果1区也满了呢？再移动到养老区。若养老区也满了，那么这个时候将产生Major GC（FullGC），进行养老区的内存清理。若养老区执行了Full GC之后发现依然无法进行对象的保存，就会产生OOM异常【OutOfMemoryError】；</p>
<p>如果出现java.lang.OutOfMemoryError:Java heap space异常，说明Java虚拟机的堆内存不够。原因有二：</p>
<ul>
<li>Java虚拟机的堆内存设置不够，可以通过参数-Xms、-Xmx来调整。</li>
<li>代码中创建了大量大对象，并且长时间不能被垃圾收集器收集（存在被引用）。</li>
</ul>
</li>
<li><p>Tenure Generation Space 养老区   Old</p>
<p>养老区用于保存从新生区筛选出来的Java对象，一般池对象都在这个区域活跃。</p>
</li>
<li><p>Permanent Space 永久区                 Perm</p>
<p>永久存储区是一个常驻内存区域，用于存放JDK自身所携带的Class，Interface的元数据，也就是说它存储的是运行环境必须的类信息，被装在进此区域的数据是不会被垃圾回收器收掉的，关闭JVM才会释放此区域所占用的内存。</p>
<p>如果出现java.lang.OutOfMemoryError: PermGen space，说明是Java虚拟机对永久代Perm内存设置不够。一般出现这种情况，都是程序启动需要加载大量的第三方jar包。例如：在一个Tomcat下部署了太多的应用，或者大量动态反射生成的类不断被加载，最终导致Perm区被栈满。</p>
<ul>
<li>JDK1.6及以前：有永久代，常量池1.6在方法区；</li>
<li>JDK1.7：            有永久代，但已经逐步“去永久代”，常量池1.7在堆；</li>
<li>JDK1.8:及以后：无永久代，常量池1.8在元空间；</li>
</ul>
</li>
</ul>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_jdk7%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98%E5%88%92%E5%88%86%E5%B0%8F%E6%80%BB%E7%BB%931.png" alt="01_JVM_jdk7程序内存划分小总结1"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_jdk7%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98%E5%88%92%E5%88%86%E5%B0%8F%E6%80%BB%E7%BB%932.png" alt="01_JVM_jdk7程序内存划分小总结2"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_jdk7%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98%E5%88%92%E5%88%86%E5%B0%8F%E6%80%BB%E7%BB%933.png" alt="01_JVM_jdk7程序内存划分小总结3"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_jdk7%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98%E5%88%92%E5%88%86%E5%B0%8F%E6%80%BB%E7%BB%934.png" alt="01_JVM_jdk7程序内存划分小总结4"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_jdk1.7gc%E5%9B%BE.png" alt="01_JVM_jdk1.7gc图"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_jdk1.8gc%E5%9B%BE.png" alt="01_JVM_jdk1.8gc图"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_gc-3.png" alt="01_JVM_gc-3"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_gc-3-1.png" alt="01_JVM_gc-3-1"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_gc-3-2.png" alt="01_JVM_gc-3-2"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_gc-3-3.png" alt="01_JVM_gc-3-3"></p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_gc-3-4.png" alt="01_JVM_gc-3-4"></p>
<p>GC是什么？</p>
<ul>
<li>频繁收集Young区</li>
<li>较少收集Old区</li>
<li>基本不动Perm区</li>
</ul>
<p>JVM在进行GC时，并非每次都对上面三个内存区域一起回收的，大部分时间回收都是指新生代。</p>
<p>因此GC按照回收的区域又分了两种类型，一种是普通GC（minor GC），一种是全局GC（major GC or Full GC）</p>
<ul>
<li>普通GC（minor GC）：只针对新生代区域的GC；</li>
<li>全局GC（major GC or Full GC）：针对老年代的GC，偶尔伴随对新生代GC以及对永久代的GC；</li>
</ul>
</li>
<li><p>普通GC（minor GC）一般发生在新生代，频繁发生，此区域用到的算法是复制算法（Copying）；</p>
<p>Minor GC会把Eden中所有活的对象都移到Survivor区域中，如果Survivor去中放不下，那么剩下的活的对象就被移动到Old generation中，<strong>也就是说一旦收集后，Eden就变成空了。</strong></p>
<p>当对象在Eden（包括一个Survivor区域，这里假设是from区域）出生后，在经历一次Minor GC后，如果对象还存活，并且能够被另一块Survivor区域所容纳（上面已经假设是from区域，这里应为to区域，即to区域有足够的内存空间来存储Eden和from区域中存活的对象），则使用<strong>复制算法</strong>将这些仍然还存活的对象复制到另一块Survivor区域（即to区域）中，然后清理所使用过的Eden以及Survivor区域（即from区域），并且将这些对象的年龄设置为1，以后对象在Survivor区域每熬过一次Minor GC，就将对象的年龄+1，当对象的年龄达到某个值时（默认是15岁，通过<strong>-XX:MaxTenuringThreshold</strong>【设置对象在新生代中存活的次数】来设定参数），这些对象就会成为老年代。</p>
<p><strong>谁空谁是to，复制之后要交换</strong>；</p>
</li>
<li><p>年轻代中的GC，主要是复制算法（Copying）</p>
<p>HotSpot JVM把年轻代分为了三个部分：1个Eden区和两个Survivor区（分别叫from和to）。默认比例是8:1:1，一般情况下新创建的对象都会被分配到Eden区（一些大对象特殊处理），这些对象经过第一次Minor GC之后，如果存活，就会被移到Survivor区。对象在Survivor区中每熬过一次Minor GC，年龄就会增加1岁，当它的年龄增加到一定程度时，就会被移动到年老代中。因为年轻代中的对象基本都是朝生夕死（80%以上），所以在<strong>年轻代的垃圾回收算法使用的是复制算法</strong>，复制算法的基本思想就是讲内存分为两块，每次只用其中一块，当这一块内存用完，就将还活着的对象复制到另一块上面，<strong>复制算法不会产生内存碎片，但是会浪费一成的空间</strong>；</p>
<p>在GC开始的时候，对象只存在于Eden区和名为“From”的Survivor区，Survivor区“TO”是空的。紧接着进行GC，Eden区中所有存活的对象都会被复制到“TO”，而在“From”区中，仍存活的对象会根据他们的年龄值来决定去向。年龄达到一定值（年龄阈值，可以通过<strong>-XX:MaxTenuringThreshold</strong>来设置）的对象会被移动到年老代中，没有达到阈值的对象会被复制到“TO”区域。<strong>经过这次的GC后，Eden区和From区已经被清空，这个时候，“From”和“TO”会交换他们的角色，也就是新的“TO”就是上次GC前的“From”，新的“From”就是上次GC前的“TO”。</strong>不管怎样，都会保证名为“TO”的Survivor区域是空的。Minor GC会一直重复这样的过程，直到“TO”区域被填满，“TO”区域被填满后，会将所有的对象都移动到年老代中。</p>
</li>
<li><p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_GC%E5%9B%BE%E8%A7%A3.png" alt="GC图解"></p>
<p>因为Eden区对象一般存活率较低，一般的，使用两块10%的内存作为空闲和活动区间，而另外80%的内存，则是用来给新建对象分配内存的，一旦发生GC，将10%的活动区间与另外80%中存活的对象转移到10%的空闲区间，接下来，将之前90%的内存全部释放，以此类推。</p>
</li>
<li><p>复制算法弥补了标记-清除算法中，内存布局混乱的缺点。不过与此同时，它的缺点也是相当明显的。</p>
<ul>
<li>它浪费了一半的内存，这太要命了。</li>
<li>如果对象的存活率很高，我们可以极端一点，假设是100%存活，那么我们需要将所有的对象都复制一遍，并将所有引用地址重置一遍。复制这一工作所需要花费的时间，在对象存活率达到一定程度时，将会变得不可忽视。</li>
<li>所以从以上描述不难看出，复制算法想要使用，<strong>最起码对象的存活率要非常低才行</strong>，而且最重要的是，我们必须要克服50%内存的浪费。</li>
</ul>
</li>
<li><p>老年代一般是由标记-清除或者是标记-清除与标记-整理的混合实现</p>
</li>
<li><p>标记-清除（Mark-Sweep）</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E5%9B%BE%E8%A7%A3.png" alt="01_JVM_标记清除图解"></p>
<p>劣势：</p>
<ul>
<li>首先，它的缺点就是效率比较低（递归和全堆对象遍历），而且在进行GC的时候，需要停止应用程序，这回导致用户体验非常差劲。</li>
<li>其次，主要的缺点泽森这种方式清理出来的空闲内存是不连续的，这点不难理解，我们死亡的对象都是随机出现在内存的各个角落的，现在把它们清除后，内存的布局自然会乱七八糟。而为了应付这点，<strong>JVM就不得不维持一个内存的空闲列表</strong>，这又是一种开销。而且在分配数组对象的时候，寻找连续的内存空间会不太好找。</li>
</ul>
</li>
<li><p>标记-整理（Mark-Compact）</p>
<p>存活的打标记</p>
<p><img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/blog/jvm/jvm1/01_JVM_%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86%E5%9B%BE%E8%A7%A3.png" alt="01_JVM_标记整理图解"></p>
<p>劣势：</p>
<ul>
<li>标记-整理算法唯一的缺点就是效率也不高，不仅要标记所有存活的对象，还要整理所有存活对象的引用地址。从效率上说，标记-整理算法要低于复制算法。</li>
</ul>
</li>
<li><p>总结：</p>
<ul>
<li><p>内存效率：复制算法&gt;标记-清除算法&gt;标记-整理算法（此处的效率只是简单对比时间复杂度，实际情况不一定如此）；</p>
</li>
<li><p>内存整齐度：复制算法=标记-整理算法&gt;标记-清除算法。</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>内存利用率：标记-整理算法=标记-清除算法&gt;复制算法</p>
<p>  可以看出，效率上来说，复制算法是当之无愧的老大，但是却浪费了太多内存，而为了尽量兼顾上面所提到的三个指标，标记-整理算法相对来说更平滑一些，但效率上依然不尽如人意，它比复制算法多了一个标记的阶段，又比标记-清除算法多了一个整理内存的过程。</p>
<p>  难道就没有一种最优算法吗？</p>
<p>  答案：无，没有最好的算法，只有最合适的算法==&gt;<strong>分代收集算法</strong>；</p>
</li>
</ul>
<ol start="28">
<li>问题：<ul>
<li>JVM内存模型以及分区，需要详细到每个区放什么。</li>
<li>堆里面的分区：Eden，Survivor From TO，老年代，各自的特点。</li>
<li>GC的三种收集方法：标记-清除、标记-整理、复制算法的原理与特点。</li>
<li>Minor GC和Full GC分别在什么时候发生。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/29/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/31/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tomxwd"
      src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/blog_headImg/%E9%B1%BC%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">tomxwd</p>
  <div class="site-description" itemprop="description">tomxwd</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">435</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tomxwd" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tomxwd" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备18158552号-1 </a>
      <img src="https://raw.githubusercontent.com/tomxwd/ImageHosting/master/resource/ico/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=18158552" rel="noopener" target="_blank">1213123 </a>
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-bug"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tomxwd</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

</body>
</html>
